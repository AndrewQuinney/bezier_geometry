#include "Shape.hpp"
#include "TestUtils.hpp"

template <typename A, typename B>
std::ostream &operator<<(std::ostream &os, const std::pair<A, B> &input) {
  os << "(" << input.first << "," << input.second << ")";
  return os;
}

template <typename T>
std::ostream &operator<<(std::ostream &os, const std::vector<T> &input) {
  os << "[";
  for (const T &current : input) {
    if (&current != &input.front()) {
      os << ",";
    }
    os << current;
  }
  os << "]";
  return os;
}

void boundsAndEdgesTest() {
  TEST_START {
    bezier_geometry::Shape testShape(
        {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(3, 2)},
        {bezier_geometry::Point2D(2, 2), bezier_geometry::Point2D(2, 1)});
    CHECK(
        testShape.getEdges().size(),
        static_cast<std::vector<bezier_geometry::BezierCurveQ>::size_type>(2));
    CHECK(bezier_geometry::sufficientlyClose(testShape.getMaxX(), 3), true);
    CHECK(bezier_geometry::sufficientlyClose(testShape.getMinX(), 1), true);
    CHECK(bezier_geometry::sufficientlyClose(testShape.getMaxY(), 2), true);
    CHECK(bezier_geometry::sufficientlyClose(testShape.getMinY(), 1), true);
    CHECK(testShape.getEdges().front().valueAt(0),
          bezier_geometry::Point2D(1, 1));
    CHECK(testShape.getEdges().front().valueAt(1),
          bezier_geometry::Point2D(3, 2));
    CHECK(testShape.getEdges().back().valueAt(0),
          bezier_geometry::Point2D(3, 2));
    CHECK(testShape.getEdges().back().valueAt(1),
          bezier_geometry::Point2D(1, 1));
  }
  {
    bezier_geometry::Shape testShape(
        {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 5)},
        {bezier_geometry::Point2D(0, 2), bezier_geometry::Point2D(3, 4)});
    CHECK(
        testShape.getEdges().size(),
        static_cast<std::vector<bezier_geometry::BezierCurveQ>::size_type>(2));
    CHECK(bezier_geometry::sufficientlyClose(testShape.getMaxX(), 2), true);
    CHECK(bezier_geometry::sufficientlyClose(testShape.getMinX(), 0.5), true);
    CHECK(bezier_geometry::sufficientlyClose(testShape.getMaxY(), 5), true);
    CHECK(bezier_geometry::sufficientlyClose(testShape.getMinY(), 1), true);
    CHECK(testShape.getEdges().front().valueAt(0),
          bezier_geometry::Point2D(1, 1));
    CHECK(testShape.getEdges().front().valueAt(1),
          bezier_geometry::Point2D(1, 5));
    CHECK(testShape.getEdges().back().valueAt(0),
          bezier_geometry::Point2D(1, 5));
    CHECK(testShape.getEdges().back().valueAt(1),
          bezier_geometry::Point2D(1, 1));
  }
  TEST_END
}

void shiftTest() {
  TEST_START
  typedef struct {
    bezier_geometry::Shape moving;
    bezier_geometry::Shape stationary;
    bezier_geometry::RealNum slope;
    bool right;
    bool up;
    bezier_geometry::RealNum expectedDistance;
  } ShiftAgainstTestEntry;
  const std::vector<ShiftAgainstTestEntry> testEntries(
      {{bezier_geometry::Shape({bezier_geometry::Point2D(1200, 1200),
                                bezier_geometry::Point2D(400, 400)},
                               {bezier_geometry::Point2D(400, 1200),
                                bezier_geometry::Point2D(1200, 400)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(300, 300),
                                bezier_geometry::Point2D(600, 300),
                                bezier_geometry::Point2D(300, 600)},
                               {bezier_geometry::Point2D(450, 300),
                                bezier_geometry::Point2D(300, 300),
                                bezier_geometry::Point2D(300, 450)}),
        0, false, true, 46.410161513775506137},
       {bezier_geometry::Shape(
            {bezier_geometry::Point2D(4314.4479583814954822,
                                      1907.6915462307647431),
             bezier_geometry::Point2D(4660.8581198952670093,
                                      2107.6915462307647431),
             bezier_geometry::Point2D(4660.8581198952715567,
                                      2507.6915462307656526),
             bezier_geometry::Point2D(4314.4479583814954822,
                                      2707.6915462307651978),
             bezier_geometry::Point2D(3968.0377968677216813,
                                      2507.6915462307647431),
             bezier_geometry::Point2D(3968.0377968677216813,
                                      2107.6915462307647431)},
            {bezier_geometry::Point2D(4545.3880660573486239,
                                      1907.6915462307647431),
             bezier_geometry::Point2D(4776.3281737331981276,
                                      2307.6915462307642883),
             bezier_geometry::Point2D(4545.3880660573486239,
                                      2707.6915462307647431),
             bezier_geometry::Point2D(4083.5078507056464332,
                                      2707.6915462307647431),
             bezier_geometry::Point2D(3852.5677430297951105,
                                      2307.6915462307642883),
             bezier_geometry::Point2D(4083.5078507056464332,
                                      1907.6915462307647431)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(4979.9999999999990905,
                                      2196.1952270217338992),
             bezier_geometry::Point2D(4954.9999999999990905,
                                      2239.4964972109560222),
             bezier_geometry::Point2D(4904.9999999999990905,
                                      2239.4964972109560222),
             bezier_geometry::Point2D(4879.9999999999990905,
                                      2196.1952270217338992),
             bezier_geometry::Point2D(4904.9999999999990905,
                                      2152.8939568325117762),
             bezier_geometry::Point2D(4954.9999999999990905,
                                      2152.8939568325117762)},
            {bezier_geometry::Point2D(4979.9999999999990905,
                                      2225.0627404812153145),
             bezier_geometry::Point2D(4929.9999999999990905,
                                      2253.9302539406967298),
             bezier_geometry::Point2D(4879.9999999999990905,
                                      2225.0627404812153145),
             bezier_geometry::Point2D(4879.9999999999990905,
                                      2167.3277135622524838),
             bezier_geometry::Point2D(4929.9999999999990905,
                                      2138.4602001027710685),
             bezier_geometry::Point2D(4979.9999999999990905,
                                      2167.3277135622524838)}),
        0.575929, true, true, 277.61994522557415621},
       {bezier_geometry::Shape(
            {bezier_geometry::Point2D(3853.3558020632717671,
                                      1519.649026681401665),
             bezier_geometry::Point2D(3828.3558020632717671,
                                      1562.950296870623788),
             bezier_geometry::Point2D(3778.3558020632717671,
                                      1562.950296870623788),
             bezier_geometry::Point2D(3753.3558020632717671,
                                      1519.649026681401665),
             bezier_geometry::Point2D(3778.3558020632717671,
                                      1476.347756492179542),
             bezier_geometry::Point2D(3828.3558020632717671,
                                      1476.347756492179542)},
            {bezier_geometry::Point2D(3853.3558020632717671,
                                      1548.5165401408830803),
             bezier_geometry::Point2D(3803.3558020632717671,
                                      1577.3840536003644957),
             bezier_geometry::Point2D(3753.3558020632717671,
                                      1548.5165401408830803),
             bezier_geometry::Point2D(3753.3558020632717671,
                                      1490.7815132219202496),
             bezier_geometry::Point2D(3803.3558020632708576,
                                      1461.9139997624388343),
             bezier_geometry::Point2D(3853.3558020632717671,
                                      1490.7815132219202496)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3953.3557925762879677,
                                      1519.5987344167706397),
             bezier_geometry::Point2D(3928.3557925762879677,
                                      1562.9000046059923079),
             bezier_geometry::Point2D(3878.3557925762861487,
                                      1562.9000046059932174),
             bezier_geometry::Point2D(3853.3557925762861487,
                                      1519.5987344167706397),
             bezier_geometry::Point2D(3878.3557925762861487,
                                      1476.2974642275489714),
             bezier_geometry::Point2D(3928.3557925762879677,
                                      1476.2974642275489714)},
            {bezier_geometry::Point2D(3953.3557925762879677,
                                      1548.466247876252055),
             bezier_geometry::Point2D(3903.3557925762861487,
                                      1577.3337613357334703),
             bezier_geometry::Point2D(3853.3557925762861487,
                                      1548.466247876252055),
             bezier_geometry::Point2D(3853.3557925762861487,
                                      1490.7312209572896791),
             bezier_geometry::Point2D(3903.3557925762861487,
                                      1461.8637074978082637),
             bezier_geometry::Point2D(3953.3557925762879677,
                                      1490.7312209572892243)}),
        1324.6860889234112619, false, false, -1},
       {bezier_geometry::Shape(
            {bezier_geometry::Point2D(400.00000000000068212,
                                      600.00000550604113414),
             bezier_geometry::Point2D(375.00000000000068212,
                                      643.30127569526462139),
             bezier_geometry::Point2D(324.99999999999795364,
                                      643.30127569526325715),
             bezier_geometry::Point2D(299.99999999999977263,
                                      600.00000550604113414),
             bezier_geometry::Point2D(324.99999999999795364,
                                      556.6987353168167374),
             bezier_geometry::Point2D(375.00000000000068212,
                                      556.6987353168167374)},
            {bezier_geometry::Point2D(400.00000000000068212,
                                      628.86751896552345897),
             bezier_geometry::Point2D(350.00000000000159162,
                                      657.73503242500487431),
             bezier_geometry::Point2D(299.99999999999977263,
                                      628.86751896552345897),
             bezier_geometry::Point2D(299.99999999999977263,
                                      571.13249204655744506),
             bezier_geometry::Point2D(350.00000000000159162,
                                      542.26497858707602973),
             bezier_geometry::Point2D(400.00000000000068212,
                                      571.13249204655744506)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(300, 300),
                                bezier_geometry::Point2D(600, 300),
                                bezier_geometry::Point2D(300, 600)},
                               {bezier_geometry::Point2D(450, 300),
                                bezier_geometry::Point2D(300, 300),
                                bezier_geometry::Point2D(300, 450)}),
        static_cast<bezier_geometry::RealNum>(
            std::numeric_limits<bezier_geometry::RealNum>::infinity() * (-1.0)),
        true, false, 0},
       {bezier_geometry::Shape(
            {bezier_geometry::Point2D(4775.8548115672647327,
                                      2114.9999999999949978),
             bezier_geometry::Point2D(5122.2649730810335313,
                                      2314.9999999999968168),
             bezier_geometry::Point2D(5122.2649730810362598,
                                      2714.9999999999977263),
             bezier_geometry::Point2D(4775.8548115672647327,
                                      2915.0000000000004547),
             bezier_geometry::Point2D(4429.4446500534886582,
                                      2714.9999999999986358),
             bezier_geometry::Point2D(4429.4446500534886582,
                                      2314.9999999999968168)},
            {bezier_geometry::Point2D(5006.7949192431087795,
                                      2114.9999999999949978),
             bezier_geometry::Point2D(5237.7350269189646497,
                                      2514.999999999996362),
             bezier_geometry::Point2D(5006.7949192431087795,
                                      2914.9999999999949978),
             bezier_geometry::Point2D(4544.9147038914070436,
                                      2914.9999999999949978),
             bezier_geometry::Point2D(4313.9745962155611778,
                                      2514.999999999996362),
             bezier_geometry::Point2D(4544.9147038914070436,
                                      2114.9999999999949978)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(0, 2915),
                                bezier_geometry::Point2D(5280, 2915),
                                bezier_geometry::Point2D(5280, 3015),
                                bezier_geometry::Point2D(0, 3015)},
                               {bezier_geometry::Point2D(2640, 2915),
                                bezier_geometry::Point2D(5280, 2965),
                                bezier_geometry::Point2D(2640, 3015),
                                bezier_geometry::Point2D(0, 2965)}),
        std::numeric_limits<bezier_geometry::RealNum>::infinity(), true, true,
        0},
       {bezier_geometry::Shape(
            {bezier_geometry::Point2D(201.1271242968707611,
                                      2671.7201289373456348),
             bezier_geometry::Point2D(166.5779740156178832,
                                      2719.2729547521080349),
             bezier_geometry::Point2D(110.67627457812045577,
                                      2701.1093915519718394),
             bezier_geometry::Point2D(110.67627457812045577,
                                      2642.3308663227212492),
             bezier_geometry::Point2D(166.57797401561651895,
                                      2624.1673031225877821)},
            {bezier_geometry::Point2D(201.1271242968707611,
                                      2708.0472553376162068),
             bezier_geometry::Point2D(132.0288237343644937,
                                      2730.498654166596225),
             bezier_geometry::Point2D(89.323725421879544228,
                                      2671.7201289373456348),
             bezier_geometry::Point2D(132.0288237343644937,
                                      2612.9416037080959541),
             bezier_geometry::Point2D(201.1271242968707611,
                                      2635.3930025370768817)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(0, 0),
                                bezier_geometry::Point2D(100, 0),
                                bezier_geometry::Point2D(100, 3015),
                                bezier_geometry::Point2D(0, 3015)},
                               {bezier_geometry::Point2D(50, 0),
                                bezier_geometry::Point2D(100, 1507.5),
                                bezier_geometry::Point2D(50, 3015),
                                bezier_geometry::Point2D(0, 1507.5)}),
        7908855.3983483612537, false, false, 0},
       {bezier_geometry::Shape(
            {bezier_geometry::Point2D(201.12712429686843052,
                                      1442.7762019026979488),
             bezier_geometry::Point2D(166.57797401561577999,
                                      1490.329027717455574),
             bezier_geometry::Point2D(110.67627457812108105,
                                      1472.1654645173216522),
             bezier_geometry::Point2D(110.67627457812108105,
                                      1413.3869392880742453),
             bezier_geometry::Point2D(166.57797401561577999,
                                      1395.2233760879403235)},
            {bezier_geometry::Point2D(201.12712429686843052,
                                      1479.1033283029657923),
             bezier_geometry::Point2D(132.02882373436335683,
                                      1501.5547271319453557),
             bezier_geometry::Point2D(89.323725421879032638,
                                      1442.7762019026979488),
             bezier_geometry::Point2D(132.02882373436312946,
                                      1383.9976766734507692),
             bezier_geometry::Point2D(201.12712429686843052,
                                      1406.4490755024298778)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(0, 0),
                                bezier_geometry::Point2D(100, 0),
                                bezier_geometry::Point2D(100, 3015),
                                bezier_geometry::Point2D(0, 3015)},
                               {bezier_geometry::Point2D(50, 0),
                                bezier_geometry::Point2D(100, 1507.5),
                                bezier_geometry::Point2D(50, 3015),
                                bezier_geometry::Point2D(0, 1507.5)}),
        -8050233.0086381975561, false, true, 0},
       {bezier_geometry::Shape(
            {bezier_geometry::Point2D(661.11470014634596737,
                                      100.00000000000011369),
             bezier_geometry::Point2D(661.11470014634596737,
                                      1700.0000000000004547),
             bezier_geometry::Point2D(1061.1147001463459674,
                                      1700.0000000000004547),
             bezier_geometry::Point2D(1061.1147001463459674, 100)},
            {bezier_geometry::Point2D(661.11470014634596737,
                                      900.00000000000011369),
             bezier_geometry::Point2D(861.11470014634596737,
                                      1700.0000000000004547),
             bezier_geometry::Point2D(1061.1147001463459674,
                                      900.00000000000011369),
             bezier_geometry::Point2D(861.11470014634596737,
                                      100.00000000000011369)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(0, 0),
                                bezier_geometry::Point2D(5280, 0),
                                bezier_geometry::Point2D(5280, 100),
                                bezier_geometry::Point2D(0, 100)},
                               {bezier_geometry::Point2D(2640, 0),
                                bezier_geometry::Point2D(5280, 50),
                                bezier_geometry::Point2D(2640, 100),
                                bezier_geometry::Point2D(0, 50)}),
        static_cast<bezier_geometry::RealNum>(
            (-1.0) * std::numeric_limits<bezier_geometry::RealNum>::infinity()),
        true, false, 0},
       {bezier_geometry::Shape(
            {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(3, 1),
             bezier_geometry::Point2D(3, 3), bezier_geometry::Point2D(1, 3)},
            {bezier_geometry::Point2D(2, 1), bezier_geometry::Point2D(3, 2),
             bezier_geometry::Point2D(2, 3), bezier_geometry::Point2D(1, 2)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3, 1), bezier_geometry::Point2D(5, 1),
             bezier_geometry::Point2D(5, 3), bezier_geometry::Point2D(3, 3)},
            {bezier_geometry::Point2D(4, 1), bezier_geometry::Point2D(5, 2),
             bezier_geometry::Point2D(4, 3), bezier_geometry::Point2D(3, 2)}),
        0, true, true, 0},
       {// Two rectangles, the moving is directly above the first with its
        // bottom edge infinitely intersectng the top edge of the stationary.
        // The endpoints are also the same.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1467.1572875253809798, 1500),
             bezier_geometry::Point2D(1467.1572875253809798, 2000),
             bezier_geometry::Point2D(1667.1572875253809798, 2000),
             bezier_geometry::Point2D(1667.1572875253809798, 1500)},
            {bezier_geometry::Point2D(1467.1572875253809798, 1750),
             bezier_geometry::Point2D(1567.1572875253809798, 2000),
             bezier_geometry::Point2D(1667.1572875253809798, 1750),
             bezier_geometry::Point2D(1567.1572875253809798, 1500)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1467.1572875253809798, 1000),
             bezier_geometry::Point2D(1467.1572875253809798, 1500),
             bezier_geometry::Point2D(1667.1572875253809798, 1500),
             bezier_geometry::Point2D(1667.1572875253809798, 1000)},
            {bezier_geometry::Point2D(1467.1572875253809798, 1250),
             bezier_geometry::Point2D(1567.1572875253809798, 1500),
             bezier_geometry::Point2D(1667.1572875253809798, 1250),
             bezier_geometry::Point2D(1567.1572875253809798, 1000)}),
        static_cast<bezier_geometry::RealNum>(
            std::numeric_limits<bezier_geometry::RealNum>::infinity() * (-1.0)),
        true, false, 0},
       {// Not sure what this is.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(10, 10), bezier_geometry::Point2D(10, 9),
             bezier_geometry::Point2D(9, 8), bezier_geometry::Point2D(9, 11)},
            {bezier_geometry::Point2D(10, 9.5),
             bezier_geometry::Point2D(9.5, 8.5),
             bezier_geometry::Point2D(9, 9.5),
             bezier_geometry::Point2D(9.5, 10.5)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(10, 10), bezier_geometry::Point2D(10, 9),
             bezier_geometry::Point2D(11, 9), bezier_geometry::Point2D(11, 10)},
            {bezier_geometry::Point2D(10, 9.5),
             bezier_geometry::Point2D(10.5, 9),
             bezier_geometry::Point2D(11, 9.5),
             bezier_geometry::Point2D(10.5, 10)}),
        0, true, true, 0},
       {
           // Stationary shape blocks and any shift will cause an overlap,
           // blocking all subsequent shifts.  This is only detected if the
           // shape relevant edge calculation works correctly.
           bezier_geometry::Shape(
               {
                   bezier_geometry::Point2D(1409.6483244438563815,
                                            1476.2797022645052039),
                   bezier_geometry::Point2D(2209.6483244438563815,
                                            2861.920348319607001),
                   bezier_geometry::Point2D(2556.0584859576315466,
                                            2661.920348319607001),
                   bezier_geometry::Point2D(1756.0584859576320014,
                                            1276.2797022645052039),
               },
               {
                   bezier_geometry::Point2D(1809.6483244438563815,
                                            2169.1000252920562161),
                   bezier_geometry::Point2D(2382.8534052007439641,
                                            2761.920348319607001),
                   bezier_geometry::Point2D(2156.0584859576315466,
                                            1969.1000252920562161),
                   bezier_geometry::Point2D(1582.8534052007439641,
                                            1376.2797022645052039),
               }),
           bezier_geometry::Shape(
               {
                   bezier_geometry::Point2D(1742.660857216297245,
                                            1053.0746316587228648),
                   bezier_geometry::Point2D(1309.6483447462812819,
                                            1303.074959747316143),
                   bezier_geometry::Point2D(1409.6484759817185477,
                                            1476.2799647353224373),
                   bezier_geometry::Point2D(1842.6609884517345108,
                                            1226.2796366467291591),
               },
               {
                   bezier_geometry::Point2D(1526.1546009812891498,
                                            1178.0747957030193902),
                   bezier_geometry::Point2D(1359.6484103639998011,
                                            1389.6774622413192901),
                   bezier_geometry::Point2D(1626.1547322167264156,
                                            1351.2798006910259119),
                   bezier_geometry::Point2D(1792.6609228340157642,
                                            1139.677134152726012),
               }),
           -0.57735127944115527399, false, true,
           /*0*/ -1
           /*
            * I changed this because not blocking is correct - the shift is
            * right along the slope of the touching stationary edge and the
            * moving rectangle is overlapping it a tiny bit, but the edge in the
            * moving shape is more horizontal (smaller slope) than the touching
            * stationary edge, causing this shift to REDUCE their overlap.
            * */
       },
       {// An intersection with the stationary edge blocks, but it is between 2
        // straight lines with very similar slopes.  Tests the tiebreaker logic.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1583.8376488019077897,
                                      1469.4028213176065947),
             bezier_geometry::Point2D(2383.8376488019075623,
                                      2855.0434673727086192),
             bezier_geometry::Point2D(2730.2478103156827274,
                                      2655.0434673727086192),
             bezier_geometry::Point2D(1930.2478103156834095,
                                      1269.4028213176065947)},
            {bezier_geometry::Point2D(1983.8376488019077897,
                                      2162.2231443451573796),
             bezier_geometry::Point2D(2557.0427295587951448,
                                      2755.0434673727086192),
             bezier_geometry::Point2D(2330.2478103156827274,
                                      1962.2231443451576069),
             bezier_geometry::Point2D(1757.0427295587953722,
                                      1369.402821317606594)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1410.6324443538790092,
                                      1569.4026070779600559),
             bezier_geometry::Point2D(1660.6319100185135085,
                                      2002.4156174684069356),
             bezier_geometry::Point2D(1833.8371141746922603,
                                      1902.4158312025531359),
             bezier_geometry::Point2D(1583.8376485100577611,
                                      1469.4028208121062562)},
            {bezier_geometry::Point2D(1535.6321771861962588,
                                      1785.9091122731833821),
             bezier_geometry::Point2D(1747.2345120966028844,
                                      1952.4157243354800357),
             bezier_geometry::Point2D(1708.8373813423750107,
                                      1685.9093260073298097),
             bezier_geometry::Point2D(1497.2350464319683851,
                                      1519.4027139450331561)}),
        -0.57734862386515928279, false, true, 0},
       {// Not quite intersecting, the stationary blocks after a short distance;
        // moving shape has a mangitude crit inside an edge that is not at the
        // maximum magnitude.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1704.3704027547369151,
                                      1945.4171852243384819),
             bezier_geometry::Point2D(1290.2446251557742016,
                                      1665.2389556488510607),
             bezier_geometry::Point2D(1178.1733333255792786,
                                      1830.889266688436237),
             bezier_geometry::Point2D(1592.2991109245419921,
                                      2111.0674962639236583)},
            {bezier_geometry::Point2D(1497.307513955255672,
                                      1805.3280704365947713),
             bezier_geometry::Point2D(1234.2089792406768538,
                                      1748.0641111686436489),
             bezier_geometry::Point2D(1385.2362221250605216,
                                      1970.9783814761799476),
             bezier_geometry::Point2D(1648.3347568396393399,
                                      2028.2423407441310701)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1467.1572875253809798,
                                      1682.8427124746190202),
             bezier_geometry::Point2D(1432.6081372441283293,
                                      1730.3955382893766455),
             bezier_geometry::Point2D(1376.7064378066336303,
                                      1712.2319750892427237),
             bezier_geometry::Point2D(1376.7064378066336303,
                                      1653.4534498599953167),
             bezier_geometry::Point2D(1432.6081372441283293,
                                      1635.2898866598613949)},
            {bezier_geometry::Point2D(1467.1572875253809798,
                                      1719.1698388748868638),
             bezier_geometry::Point2D(1398.0589869628759061,
                                      1741.6212377038661998),
             bezier_geometry::Point2D(1355.3538886503915819,
                                      1682.8427124746190202),
             bezier_geometry::Point2D(1398.0589869628756787,
                                      1624.0641872453718406),
             bezier_geometry::Point2D(1467.1572875253809798,
                                      1646.5155860743509493)}),
        -1.4780797859506309422, true, false, 5.7943666785049670054},
       {// Stationary blocks shift after a very short distance, stationary's
        // magnitude crits come at intersections of edges.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3801.3094282839888365,
                                      458.3313155185173855),
             bezier_geometry::Point2D(4601.3094282839883817,
                                      1843.97196157361941),
             bezier_geometry::Point2D(4947.7195897977635468,
                                      1643.97196157361941),
             bezier_geometry::Point2D(4147.7195897977644563,
                                      258.3313155185173855)},
            {bezier_geometry::Point2D(4201.3094282839883817,
                                      1151.1516385460683978),
             bezier_geometry::Point2D(4774.5145090408768738,
                                      1743.97196157361941),
             bezier_geometry::Point2D(4547.7195897977635468,
                                      951.15163854606839777),
             bezier_geometry::Point2D(3974.514509040876419,
                                      358.3313155185173855)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(5180, 545.181707371913717),
             bezier_geometry::Point2D(4980, 891.59186888568910945),
             bezier_geometry::Point2D(4580, 891.59186888568910945),
             bezier_geometry::Point2D(4380, 545.181707371913717),
             bezier_geometry::Point2D(4580, 198.77154585813832455),
             bezier_geometry::Point2D(4980, 198.77154585813832455)},
            {bezier_geometry::Point2D(5180, 776.12181504776390284),
             bezier_geometry::Point2D(4780, 1007.0619227236145434),
             bezier_geometry::Point2D(4380, 776.12181504776413021),
             bezier_geometry::Point2D(4380, 314.24159969606353116),
             bezier_geometry::Point2D(4780, 83.301492020213117939),
             bezier_geometry::Point2D(5180, 314.24159969606330378)}),
        -0.57742008239574582618, true, false, 0.00051319094687760405914},
       {// Shapes are touching with a significant perpendicular mangitude
        // overlap, stationary is just barely not in the shift path.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1667.2011391171122341,
                                      957.7948983573184023),
             bezier_geometry::Point2D(1667.2011391171122341,
                                      1257.7948983573182886)},
            {bezier_geometry::Point2D(1667.2011391171122341,
                                      1107.7948983573182886),
             bezier_geometry::Point2D(2167.2011391171122341,
                                      1107.7948983573182886)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1467.2011438949941748,
                                      982.21224169772949608),
             bezier_geometry::Point2D(1467.0918520618620278,
                                      1482.2122297530245305),
             bezier_geometry::Point2D(1667.091847283980087,
                                      1482.2559464862774803),
             bezier_geometry::Point2D(1667.2011391171122341,
                                      982.25595843098233217)},
            {bezier_geometry::Point2D(1467.146497978428215,
                                      1232.2122357253770133),
             bezier_geometry::Point2D(1567.0918496729209437,
                                      1482.2340881196510054),
             bezier_geometry::Point2D(1667.1464932005460469,
                                      1232.2559524586299631),
             bezier_geometry::Point2D(1567.2011415060530908,
                                      982.23410006435597097)}),
        -4574.9071429755822464, true, false, -1},
       {// No initial intersection, stationary is in shift path, multiple block
        // points between edges.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1239.2990922340604811,
                                      1118.7050402710026447),
             bezier_geometry::Point2D(1738.1991316986495804,
                                      1151.8524477447631398),
             bezier_geometry::Point2D(1751.4580946881537784,
                                      952.29243195892752283),
             bezier_geometry::Point2D(1252.5580552235646792,
                                      919.14502448516702771)},
            {bezier_geometry::Point2D(1488.7491119663550307,
                                      1135.2787440078830059),
             bezier_geometry::Point2D(1744.8286131934016794,
                                      1052.0724398518452745),
             bezier_geometry::Point2D(1502.0080749558592288,
                                      935.71872822204727527),
             bezier_geometry::Point2D(1245.9285737288125802,
                                      1018.9250323780847793)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1767.9723273236518253,
                                      960.97350496461035618),
             bezier_geometry::Point2D(1751.4580941446611178,
                                      948.58783008036732554)},
            {bezier_geometry::Point2D(1759.7152107341564715,
                                      954.7806675224888977),
             bezier_geometry::Point2D(1819.7152107341564715,
                                      874.7806675224888977)}),
        0, true, false, 4.9394686279208599444},
       {// Touching, stationary blocks; touching edges are NEARLY infinitely
        // intersecting, but there is a tiny slope difference.
        bezier_geometry::Shape({bezier_geometry::Point2D(1667.160540904453228,
                                                         1588.20291164031687),
                                bezier_geometry::Point2D(1667.160540904453228,
                                                         1888.20291164031687)},
                               {bezier_geometry::Point2D(1667.160540904453228,
                                                         1738.20291164031687),
                                bezier_geometry::Point2D(2167.160540904453228,
                                                         1738.20291164031687)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1467.1634553466360558,
                                      1503.414988116890072),
             bezier_geometry::Point2D(1467.1462679912795011,
                                      2003.4149878214848286),
             bezier_geometry::Point2D(1667.1462678731174947,
                                      2003.4218627636275869),
             bezier_geometry::Point2D(1667.1634552284740494,
                                      1503.4218630590326029)},
            {bezier_geometry::Point2D(1467.1548616689578921,
                                      1753.4149879691874503),
             bezier_geometry::Point2D(1567.1462679321984979,
                                      2003.4184252925560941),
             bezier_geometry::Point2D(1667.1548615507956583,
                                      1753.4218629113302086),
             bezier_geometry::Point2D(1567.1634552875550526,
                                      1503.4184255879613374)}),
        3.4374710734010592052e-5, false, false, 0},
       {// No initial intersection, stationary is in shift path, slope is
        // special in that edge endpoint magnitudes don't quite line up.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1264.4309784441875308,
                                      816.17448779658730018),
             bezier_geometry::Point2D(2064.4309784441879856,
                                      2201.8151338516900068),
             bezier_geometry::Point2D(2410.8411399579626959,
                                      2001.8151338516890974),
             bezier_geometry::Point2D(1610.8411399579631507,
                                      616.17448779658718649)},
            {bezier_geometry::Point2D(1664.4309784441877582,
                                      1508.9948108241383125),
             bezier_geometry::Point2D(2237.6360592010755681,
                                      2101.8151338516890974),
             bezier_geometry::Point2D(2010.8411399579626959,
                                      1308.9948108241380851),
             bezier_geometry::Point2D(1437.6360592010751134,
                                      716.17448779658730018)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1467.1572875253809798,
                                      1682.8427124746190202),
             bezier_geometry::Point2D(1432.6081372441283293,
                                      1730.3955382893766455),
             bezier_geometry::Point2D(1376.7064378066336303,
                                      1712.2319750892427237),
             bezier_geometry::Point2D(1376.7064378066336303,
                                      1653.4534498599953167),
             bezier_geometry::Point2D(1432.6081372441283293,
                                      1635.2898866598613949)},
            {bezier_geometry::Point2D(1467.1572875253809798,
                                      1719.1698388748868638),
             bezier_geometry::Point2D(1398.0589869628759061,
                                      1741.6212377038661998),
             bezier_geometry::Point2D(1355.3538886503915819,
                                      1682.8427124746190202),
             bezier_geometry::Point2D(1398.0589869628756787,
                                      1624.0641872453718406),
             bezier_geometry::Point2D(1467.1572875253809798,
                                      1646.5155860743509493)}),
        -0.57735026918962550901, false, true, 250.00000000000034106},
       {// Initial intersection blocks shift; the relevant edge from each shape
        // have infinite intersection, but the moving shape's is slightly
        // farther along the shift direction than that of the stationary.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(99.999999999999772626,
                                      1886.0516645908355713),
             bezier_geometry::Point2D(99.999999999999900524,
                                      2386.0516645908355713),
             bezier_geometry::Point2D(299.99999999999988631,
                                      2386.0516645908355713),
             bezier_geometry::Point2D(299.99999999999977263,
                                      1886.0516645908355713)},
            {bezier_geometry::Point2D(99.99999999999982947,
                                      2136.0516645908355713),
             bezier_geometry::Point2D(199.99999999999988631,
                                      2386.0516645908355713),
             bezier_geometry::Point2D(299.99999999999982947,
                                      2136.0516645908355713),
             bezier_geometry::Point2D(199.99999999999977263,
                                      1886.0516645908355713)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(0, 0),
                                bezier_geometry::Point2D(100, 0),
                                bezier_geometry::Point2D(100, 3015),
                                bezier_geometry::Point2D(0, 3015)},
                               {bezier_geometry::Point2D(50, 0),
                                bezier_geometry::Point2D(100, 1507.5),
                                bezier_geometry::Point2D(50, 3015),
                                bezier_geometry::Point2D(0, 1507.5)}),
        0, false, true, 0},
       {// Initial intersection blocks shift, infinite initial intersection
        // between edges whose slope very closely matches the shift direction.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(4362.9965542816271409,
                                      99.999999999998635758),
             bezier_geometry::Point2D(4362.9965542816271409,
                                      599.99999999999863576),
             bezier_geometry::Point2D(4562.9965542816271409,
                                      599.99999999999863576),
             bezier_geometry::Point2D(4562.9965542816271409,
                                      99.999999999998635758)},
            {bezier_geometry::Point2D(4362.9965542816271409,
                                      349.99999999999863576),
             bezier_geometry::Point2D(4462.9965542816271409,
                                      599.99999999999863576),
             bezier_geometry::Point2D(4562.9965542816271409,
                                      349.99999999999863576),
             bezier_geometry::Point2D(4462.9965542816271409,
                                      99.999999999998635758)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(0, 0),
                                bezier_geometry::Point2D(5280, 0),
                                bezier_geometry::Point2D(5280, 100),
                                bezier_geometry::Point2D(0, 100)},
                               {bezier_geometry::Point2D(2640, 0),
                                bezier_geometry::Point2D(5280, 50),
                                bezier_geometry::Point2D(2640, 100),
                                bezier_geometry::Point2D(0, 50)}),
        -1.0906e-7, // -1.0909e-7: 0, -1.0905e-7: -1
        true, false, 0},
       {
           // Shift is right along a touching (straight) edge's slope, which
           // suggests that it should not block, but that touching edge is not a
           // relevance endpoint and therefore should be the blocking point.
           bezier_geometry::Shape(
               {bezier_geometry::Point2D(3463.8919166136229251,
                                         2055.7899077816355202),
                bezier_geometry::Point2D(3459.8740212268044161,
                                         2255.7495450004016675),
                bezier_geometry::Point2D(2660.0354723517393722,
                                         2239.6779634531276315),
                bezier_geometry::Point2D(2664.053367738558336,
                                         2039.7183262343614842)},
               {bezier_geometry::Point2D(3461.8829689202138979,
                                         2155.7697263910185939),
                bezier_geometry::Point2D(3059.9547467892721215,
                                         2247.7137542267646495),
                bezier_geometry::Point2D(2662.0444200451488541,
                                         2139.6981448437445579),
                bezier_geometry::Point2D(3063.9726421760906305,
                                         2047.7541170079985022)}),
           bezier_geometry::Shape(
               {bezier_geometry::Point2D(2044.9630358216645618,
                                         1854.0536370147799516),
                bezier_geometry::Point2D(2712.8672102970867854,
                                         2272.8012220317050378),
                bezier_geometry::Point2D(3273.8099987642599444,
                                         2345.6139805025914029),
                bezier_geometry::Point2D(3694.272725480362169,
                                         1967.2363844798776427),
                bezier_geometry::Point2D(3680.8034940055786137,
                                         1401.7480207331539077),
                bezier_geometry::Point2D(3242.8028320649991656,
                                         1043.8179579148954872),
                bezier_geometry::Point2D(3124.7838933587927386,
                                         1013.1526638846783044),
                bezier_geometry::Point2D(2964.118900698455036,
                                         898.97284134446726966),
                bezier_geometry::Point2D(2920.015469173488782,
                                         706.86568616907288742),
                bezier_geometry::Point2D(3014.7911035045272001,
                                         534.04250809677387224),
                bezier_geometry::Point2D(3200.4868219650206811,
                                         467.95641358891498385),
                bezier_geometry::Point2D(3383.1356716434338523,
                                         542.04871719065863545),
                bezier_geometry::Point2D(4247.7181606306930917,
                                         1345.8940187206562769),
                bezier_geometry::Point2D(4247.7181606306930917, 2490),
                bezier_geometry::Point2D(2044.9630358216645618, 2490)},
               {bezier_geometry::Point2D(2378.9151230593752189,
                                         2063.4274295232426084),
                bezier_geometry::Point2D(2976.6011734698740838,
                                         2438.1512293920977754),
                bezier_geometry::Point2D(3571.0188240586458051,
                                         2253.0767316130859399),
                bezier_geometry::Point2D(3817.5266269020794425,
                                         1681.3960373466693454),
                bezier_geometry::Point2D(3544.0803611090777849,
                                         1122.10000411963847),
                bezier_geometry::Point2D(3183.7933627118954973,
                                         1028.4853108997867821),
                bezier_geometry::Point2D(3022.7250760718698075,
                                         986.63434678414364498),
                bezier_geometry::Point2D(2905.5127253250393551,
                                         811.31133590479021223),
                bezier_geometry::Point2D(2934.5182130219372993,
                                         602.42003643335442575),
                bezier_geometry::Point2D(3095.0639939871180104,
                                         465.66497976019172711),
                bezier_geometry::Point2D(3305.9096499429242613,
                                         470.24784741763733109),
                bezier_geometry::Point2D(3815.4269161370639267,
                                         943.97136795565734246),
                bezier_geometry::Point2D(4247.7181606306930917,
                                         1917.9470093603281384),
                bezier_geometry::Point2D(3146.340598226178372, 2490),
                bezier_geometry::Point2D(2044.9630358216645618,
                                         2172.0268185073900895)}),
           0.6269575801735529641, true, true,
           9.0949470177292823792e-13 /*1.3253225154967367416*/ /*1.6860292970281105518*/
       },
       {// Initial intersection does not block because it is just barely in a
        // non-relevant edge section; requires that shapes and curves use the
        // same criteria for matching itervals (sufficientlyCloseAlongCurve).
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(819.20786571192456904,
                                      780.45838414665956861),
             bezier_geometry::Point2D(674.30586569265790331,
                                      918.31124189874401509),
             bezier_geometry::Point2D(122.89443468432000373,
                                      338.70324182167723848),
             bezier_geometry::Point2D(267.79643470358666946,
                                      200.850384069592792)},
            {bezier_geometry::Point2D(746.75686570229117933,
                                      849.38481302270179185),
             bezier_geometry::Point2D(398.60015018848889667,
                                      628.50724186021068363),
             bezier_geometry::Point2D(195.34543469395327975,
                                      269.77681294563501524),
             bezier_geometry::Point2D(543.50215020775567609,
                                      490.65438410812618031)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(-1635.2916381389331946,
                                      425.90017035485391261),
             bezier_geometry::Point2D(9.0129195458321191836,
                                      97.250078175554449444),
             bezier_geometry::Point2D(544.67964270293578011,
                                      217.08384286284626796),
             bezier_geometry::Point2D(815.51033398961044441,
                                      694.52463093418350581),
             bezier_geometry::Point2D(643.50856940459652833,
                                      1215.7869089062608055),
             bezier_geometry::Point2D(141.71803270688269549,
                                      1438.2846094283513594),
             bezier_geometry::Point2D(-807.96367537459445884,
                                      1438.2846094283513594),
             bezier_geometry::Point2D(-1016.9677497087441225,
                                      1533.4545828266973331),
             bezier_geometry::Point2D(-1082.3983224884141237,
                                      1753.5883309677783473),
             bezier_geometry::Point2D(-959.30844005913331785,
                                      1947.4669212464955308),
             bezier_geometry::Point2D(-732.25360920995626657,
                                      1981.9071696917139889),
             bezier_geometry::Point2D(1815.9674559664445042,
                                      1258.0888121886482622),
             bezier_geometry::Point2D(1815.9674559664445042, 10),
             bezier_geometry::Point2D(-1635.2916381389331946, 10)},
            {bezier_geometry::Point2D(-813.13935929655053769,
                                      261.57512426520418103),
             bezier_geometry::Point2D(303.41387769893844961,
                                      38.407632241495662129),
             bezier_geometry::Point2D(785.9454077069331106,
                                      395.76005348419664642),
             bezier_geometry::Point2D(845.07526027228777821,
                                      993.28920838417002415),
             bezier_geometry::Point2D(441.94187853690527845,
                                      1438.2846094283509046),
             bezier_geometry::Point2D(-333.12282133385633642,
                                      1438.2846094283513594),
             bezier_geometry::Point2D(-934.1335289837570599,
                                      1438.2846094283518141),
             bezier_geometry::Point2D(-1099.8019704337302755,
                                      1628.624556225042852),
             bezier_geometry::Point2D(-1064.9946745430970623,
                                      1878.5521057105133877),
             bezier_geometry::Point2D(-853.62220557517048292,
                                      2016.3817367824767643),
             bezier_geometry::Point2D(541.85692337824366405,
                                      1619.9979909401808982),
             bezier_geometry::Point2D(1815.9674559664445042,
                                      634.04440609432413112),
             bezier_geometry::Point2D(90.337908913756109541, 10),
             bezier_geometry::Point2D(-1635.2916381389331946,
                                      217.95008517742695631)}),
        -66.765336072332587491, true, false, 2.3620315474597894934},
       {// Initial intersection blocks, but tests a border case for matching
        // edges for a given perpendicular magnitude.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1453.8371010482378551,
                                      1108.2237807747169427),
             bezier_geometry::Point2D(2461.8306306995864361,
                                      271.80589255518952996),
             bezier_geometry::Point2D(2944.3943424004392,
                                      117.64387512564064764),
             bezier_geometry::Point2D(3398.8576474455067,
                                      341.46694774320110355),
             bezier_geometry::Point2D(3570.8140483496827073,
                                      817.97996924055166801),
             bezier_geometry::Point2D(3364.0031315910473495,
                                      1280.4331108429250889),
             bezier_geometry::Point2D(2894.1967106255433464,
                                      1469.947200788858936),
             bezier_geometry::Point2D(2602.7743846440025663,
                                      1469.947200788858936),
             bezier_geometry::Point2D(2408.9446601342406211,
                                      1549.0274747832493176),
             bezier_geometry::Point2D(2325.753908658986802,
                                      1741.1288821376481337),
             bezier_geometry::Point2D(2400.6878258847364123,
                                      1936.598981865874066),
             bezier_geometry::Point2D(2590.9737582967682101,
                                      2023.862466581083936),
             bezier_geometry::Point2D(2787.9955470565519136,
                                      1953.1089041799339157),
             bezier_geometry::Point2D(3859.6108544558546782,
                                      989.9518642636792265),
             bezier_geometry::Point2D(3859.6108544558546782, 10),
             bezier_geometry::Point2D(1453.8371010482378551, 10)},
            {bezier_geometry::Point2D(1957.8338658739121456,
                                      690.01483666495323632),
             bezier_geometry::Point2D(2672.0189625648054061,
                                      97.394772348990727551),
             bezier_geometry::Point2D(3216.7697222360720843,
                                      137.89297790228999929),
             bezier_geometry::Point2D(3580.9455726549413157,
                                      545.04091758411129831),
             bezier_geometry::Point2D(3560.682524044424099,
                                      1090.9190208969907872),
             bezier_geometry::Point2D(3167.3237391376715095,
                                      1469.9472007888584812),
             bezier_geometry::Point2D(2748.4855476347729564,
                                      1469.947200788858936),
             bezier_geometry::Point2D(2489.7276062167056807,
                                      1469.9472007888591634),
             bezier_geometry::Point2D(2328.1617140517755615,
                                      1628.1077487776399266),
             bezier_geometry::Point2D(2323.346103266198952,
                                      1854.1500154976565682),
             bezier_geometry::Point2D(2478.029548503274782,
                                      2019.0479482340913364),
             bezier_geometry::Point2D(2703.9179680902625478,
                                      2028.6769849280753988),
             bezier_geometry::Point2D(3323.8032007562032959,
                                      1471.5303842218063437),
             bezier_geometry::Point2D(3859.6108544558546782,
                                      499.97593213183961325),
             bezier_geometry::Point2D(2656.7239777520462667, 10),
             bezier_geometry::Point2D(1453.8371010482378551,
                                      559.11189038735847134)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3371.3226635070463999,
                                      1007.1060652063388261),
             bezier_geometry::Point2D(3440.0806151335791583,
                                      1194.9153942827279025),
             bezier_geometry::Point2D(2688.8432988280228528,
                                      1469.9472007888591634),
             bezier_geometry::Point2D(2620.0853472014905492,
                                      1282.137871712470087)},
            {bezier_geometry::Point2D(3405.7016393203130065,
                                      1101.0107297445333643),
             bezier_geometry::Point2D(3064.4619569808010056,
                                      1332.4312975357934192),
             bezier_geometry::Point2D(2654.464323014756701,
                                      1376.0425362506646252),
             bezier_geometry::Point2D(2995.7040053542682472,
                                      1144.6219684594043429)}),
        0, false, true, 0},
       {// I don't know!
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1977.7322955244540026,
                                      162.43526988659868948),
             bezier_geometry::Point2D(2077.66524086112031,
                                      158.7737898116961901),
             bezier_geometry::Point2D(2155.6547664565432569,
                                      2287.3455254826840246),
             bezier_geometry::Point2D(2055.7218211198769495,
                                      2291.0070055575865808),
             bezier_geometry::Point2D(2022.2398169716814209,
                                      1377.1811149734942319),
             bezier_geometry::Point2D(2072.2062896400143472,
                                      1375.3503749360429538),
             bezier_geometry::Point2D(2063.0525894527581841,
                                      1125.51801159437764),
             bezier_geometry::Point2D(2013.0861167844250303,
                                      1127.3487516318289181)},
            {bezier_geometry::Point2D(2027.6987681927871563,
                                      160.60452984914743979),
             bezier_geometry::Point2D(2116.6600036588315561,
                                      1223.0596576471900789),
             bezier_geometry::Point2D(2105.6882937882101032,
                                      2289.1762655201355301),
             bezier_geometry::Point2D(2038.9808190457792989,
                                      1834.0940602655400653),
             bezier_geometry::Point2D(2047.2230533058477704,
                                      1376.2657449547687065),
             bezier_geometry::Point2D(2067.629439546386493,
                                      1250.4341932652102969),
             bezier_geometry::Point2D(2038.0693531185916072,
                                      1126.4333816131033927),
             bezier_geometry::Point2D(1995.4092061544395165,
                                      644.89201075921380379)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1272.0879098619570868,
                                      1402.3671604080500401),
             bezier_geometry::Point2D(1265.3389711633012666,
                                      1202.4810632766043454),
             bezier_geometry::Point2D(2064.8833596890845001,
                                      1175.4853084819810647),
             bezier_geometry::Point2D(2071.6322983877403203,
                                      1375.3714056134267594)},
            {bezier_geometry::Point2D(1268.7134405126291767,
                                      1302.4241118423271928),
             bezier_geometry::Point2D(1665.1111654261928834,
                                      1188.9831858792927051),
             bezier_geometry::Point2D(2068.2578290384126376,
                                      1275.428357047703912),
             bezier_geometry::Point2D(1671.8601041248487036,
                                      1388.8692830107383998)}),
        -0.036639369154658089911, false, true, 0},
       {// Almost touching at the eventual blocking point - tests the logic
        // matching edges in each shape's relevant intervals to a particular
        // magnitude.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1587.8087857540449477,
                                      1203.7845024432390346),
             bezier_geometry::Point2D(1587.7395768700907865,
                                      1403.784490468564627),
             bezier_geometry::Point2D(787.73962476878841699,
                                      1403.5076549327479825),
             bezier_geometry::Point2D(787.80883365274257812,
                                      1203.5076669074223901)},
            {bezier_geometry::Point2D(1587.7741813120678671,
                                      1303.7844964559017171),
             bezier_geometry::Point2D(1187.7396008194396018,
                                      1403.6460727006563047),
             bezier_geometry::Point2D(787.77422921076549756,
                                      1303.5076609200850726),
             bezier_geometry::Point2D(1187.8088097033937629,
                                      1203.6460846753307123)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1611.0282631873656101,
                                      257.96380140912441448),
             bezier_geometry::Point2D(1710.8237646374918768,
                                      264.355819112312588),
             bezier_geometry::Point2D(1574.6737875595845253, 2390),
             bezier_geometry::Point2D(1474.8782861094582586,
                                      2383.6079822968113149),
             bezier_geometry::Point2D(1537.6107883649558516,
                                      1404.1955634785642815),
             bezier_geometry::Point2D(1587.508539090018985,
                                      1407.3915723301583967),
             bezier_geometry::Point2D(1603.4885833479893336,
                                      1157.9028187048429572),
             bezier_geometry::Point2D(1553.5908326229262002,
                                      1154.706809853248842)},
            {bezier_geometry::Point2D(1660.9260139124287434,
                                      261.15981026071852966),
             bezier_geometry::Point2D(1642.748776098538201,
                                      1327.1779095561560098),
             bezier_geometry::Point2D(1524.7760368345213919,
                                      2386.8039911484056574),
             bezier_geometry::Point2D(1506.2445372372071688,
                                      1893.9017728876876845),
             bezier_geometry::Point2D(1562.559663727487532,
                                      1405.7935679043612254),
             bezier_geometry::Point2D(1595.4985612190041593,
                                      1282.6471955175006769),
             bezier_geometry::Point2D(1578.5397079854576532,
                                      1156.304814279045786),
             bezier_geometry::Point2D(1582.3095479051460188,
                                      706.33530563118665668)}),
        -15.612519564886712331, false, true, 0.42928819117526328952},
       {// I'm not sure what this was.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3135.131780197370972,
                                      1896.3443114297897409),
             bezier_geometry::Point2D(3135.1317801973714268,
                                      2096.3443114297897409),
             bezier_geometry::Point2D(2335.1317801973714268,
                                      2096.3443114297915599),
             bezier_geometry::Point2D(2335.131780197370972,
                                      1896.3443114297913326)},
            {bezier_geometry::Point2D(3135.131780197370972,
                                      1996.3443114297897409),
             bezier_geometry::Point2D(2735.1317801973714268,
                                      2096.3443114297906504),
             bezier_geometry::Point2D(2335.131780197370972,
                                      1996.3443114297913326),
             bezier_geometry::Point2D(2735.131780197370972,
                                      1896.3443114297906504)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3185.1317796370894939,
                                      2046.3443114297897409),
             bezier_geometry::Point2D(3185.1317796370894939,
                                      2146.3443114297897409),
             bezier_geometry::Point2D(2144.8850243808064988,
                                      2146.3443114297897409),
             bezier_geometry::Point2D(2144.8850243808064988, 2490),
             bezier_geometry::Point2D(2094.8850243808064988, 2490),
             bezier_geometry::Point2D(2094.8850243808064988,
                                      2096.3443114297897409),
             bezier_geometry::Point2D(3135.1317796370894939,
                                      2096.3443114297897409),
             bezier_geometry::Point2D(3135.1317796370894939,
                                      2046.3443114297897409)},
            {bezier_geometry::Point2D(3185.1317796370894939,
                                      2096.3443114297897409),
             bezier_geometry::Point2D(2665.0084020089479964,
                                      2146.3443114297897409),
             bezier_geometry::Point2D(2144.8850243808064988,
                                      2318.1721557148948705),
             bezier_geometry::Point2D(2119.8850243808064988, 2490),
             bezier_geometry::Point2D(2094.8850243808064988,
                                      2293.1721557148948705),
             bezier_geometry::Point2D(2615.0084020089479964,
                                      2096.3443114297897409),
             bezier_geometry::Point2D(3135.1317796370894939,
                                      2071.3443114297897409),
             bezier_geometry::Point2D(3160.1317796370894939,
                                      2046.3443114297897409)}),
        0, true, true, 0},
       {// Simple shift - initial, non-infinite intersection blocks shift;
        // returned blocked intervals used to be weird.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3659.129606379069628,
                                      1173.5456594946851965),
             bezier_geometry::Point2D(3660.8604309629681666,
                                      1373.5381699701022171),
             bezier_geometry::Point2D(2860.890389061300084,
                                      1380.4614683056961439),
             bezier_geometry::Point2D(2859.1595644774015454,
                                      1180.4689578302791233)},
            {bezier_geometry::Point2D(3659.9950186710188973,
                                      1273.5419147323937068),
             bezier_geometry::Point2D(3260.8754100121341253,
                                      1376.9998191378990668),
             bezier_geometry::Point2D(2860.0249767693508147,
                                      1280.4652130679876336),
             bezier_geometry::Point2D(3259.1445854282355867,
                                      1177.0073086624822736)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3755.8777852979856107,
                                      1401.4120229981990633),
             bezier_geometry::Point2D(3947.9958496546751121,
                                      1364.8349602400162439),
             bezier_geometry::Point2D(3972.5767425842050216,
                                      1170.8168892389776374),
             bezier_geometry::Point2D(3795.6505055317870756,
                                      1087.4841896868285858),
             bezier_geometry::Point2D(3661.7231846022418722,
                                      1229.9998199903559453)},
            {bezier_geometry::Point2D(3865.2242132980004499,
                                      1452.914463695710765),
             bezier_geometry::Point2D(4030.7674860113493196,
                                      1276.7554567843221776),
             bezier_geometry::Point2D(3914.385999157061633,
                                      1064.8783216936333247),
             bezier_geometry::Point2D(3676.9150119065138824,
                                      1110.0900576800231647),
             bezier_geometry::Point2D(3646.5313572979703167,
                                      1349.9095823006875889)}),
        -0.008654376253844, true, false, 0},
       {// The edge at the end of a relevance interval in the moving shape has
        // nearly identical magnitudes, causing the next edge to be used; tests
        // the parameters used for equivalent magnitude in the stationary edge.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3667.6976184794643814,
                                      636.69719948169392865),
             bezier_geometry::Point2D(3762.7775824530854152,
                                      567.5635567071656169),
             bezier_geometry::Point2D(3726.4089056895554677,
                                      455.77366690056908283),
             bezier_geometry::Point2D(3608.8518633502139892,
                                      455.81735817601520466),
             bezier_geometry::Point2D(3572.5662923311210761,
                                      567.63425067585012584)},
            {bezier_geometry::Point2D(3740.3518662620867872,
                                      636.67019678845622366),
             bezier_geometry::Point2D(3785.2032986440826789,
                                      498.45691662587546489),
             bezier_geometry::Point2D(3667.6145127350273469,
                                      413.09041717526372395),
             bezier_geometry::Point2D(3550.0892139654010862,
                                      498.54429917676782225),
             bezier_geometry::Point2D(3595.0433706968410661,
                                      636.72420217493174732)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3949.2987080464790779,
                                      756.00919032960666755),
             bezier_geometry::Point2D(4126.6037408651100122,
                                      674.58876463357592002),
             bezier_geometry::Point2D(4103.9585827765404247,
                                      480.80136257017494472),
             bezier_geometry::Point2D(3912.6580725785579489,
                                      442.45458719948169346),
             bezier_geometry::Point2D(3817.0730132995795429,
                                      612.54237872483702176)},
            {bezier_geometry::Point2D(4067.5289254140279809,
                                      779.70880086765203032),
             bezier_geometry::Point2D(4185.6785563161920436,
                                      569.4687283994999234),
             bezier_geometry::Point2D(4022.2386092368869868,
                                      392.1339967408499092),
             bezier_geometry::Point2D(3803.0775359202280015,
                                      492.77517765811421668),
             bezier_geometry::Point2D(3831.0684906789301749,
                                      732.30957979156096371)}),
        0, true, false, 51.840513317079057742},
       {// Moving shape shifts along the edge of stationary - the overlap in the
        // shift direction is sufficiently small, but it would result in an edge
        // of the moving shape being entirely inside the stationary.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3812.6623329704179923,
                                      934.71102487659163671),
             bezier_geometry::Point2D(3862.6623329704179923,
                                      934.71102487659163671),
             bezier_geometry::Point2D(3862.6623329704179923, 2521),
             bezier_geometry::Point2D(3812.6623329704179923, 2521)},
            {bezier_geometry::Point2D(3837.6623329704179923,
                                      934.71102487659163671),
             bezier_geometry::Point2D(3862.6623329704179923,
                                      1727.8555124382958184),
             bezier_geometry::Point2D(3837.6623329704179923, 2521),
             bezier_geometry::Point2D(3812.6623329704179923,
                                      1727.8555124382958184)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3689.9999985877266226,
                                      934.7111160564304555),
             bezier_geometry::Point2D(3689.9998499196958619,
                                      734.7111160564857073),
             bezier_geometry::Point2D(4489.9998499194753094,
                                      734.71052138436255063),
             bezier_geometry::Point2D(4489.9999985875056154,
                                      934.71052138430729883)},
            {bezier_geometry::Point2D(3689.9999242537110149,
                                      834.7111160564580814),
             bezier_geometry::Point2D(4089.9998499195853583,
                                      734.71081872042407213),
             bezier_geometry::Point2D(4489.9999242534904624,
                                      834.71052138433492473),
             bezier_geometry::Point2D(4089.999998587616119,
                                      934.71081872036882032)}),
        0, false, true, 0}});
  for (const ShiftAgainstTestEntry &currentEntry : testEntries) {
    bezier_geometry::Shape::ShiftAgainstResult result;
    debug() << "*** BEFORE shiftAgainst ***" << std::endl;
    currentEntry.moving.shiftAgainst(currentEntry.stationary,
                                     currentEntry.slope, currentEntry.right,
                                     currentEntry.up, result);
    debug() << "^ AFTER shiftAgainst -"
            << "expected:"
            << bezier_geometry::toString(currentEntry.expectedDistance)
            << "actual:"
            << bezier_geometry::toString(result.movingEdgeResult.distance)
            << "moving edge:"
            << (result.movingEdge == nullptr ? ""
                                             : result.movingEdge->toString())
            << "moving edge param:"
            << bezier_geometry::toString(result.movingEdgeResult.param)
            << "moving point:"
            << (result.movingEdge == nullptr
                    ? ""
                    : result.movingEdge->valueAt(result.movingEdgeResult.param)
                          .toString())
            << "stationary edge:"
            << (result.stationaryEdge == nullptr
                    ? ""
                    : result.stationaryEdge->toString())
            << "stationary edge param:"
            << bezier_geometry::toString(result.movingEdgeResult.inputParam)
            << "stationary point:"
            << (result.stationaryEdge == nullptr
                    ? ""
                    : result.stationaryEdge
                          ->valueAt(result.movingEdgeResult.inputParam)
                          .toString())
            << "blockedCWVerticalAngleStart:"
            << result.movingEdgeResult.blockedCWVerticalAngleStart
            << "blockedCWVerticalAngleEnd:"
            << result.movingEdgeResult.blockedCWVerticalAngleEnd << std::endl;
    CHECK(bezier_geometry::sufficientlyClose(result.movingEdgeResult.distance,
                                             currentEntry.expectedDistance),
          true);
    CHECK(result.movingEdgeResult.blockedCWVerticalAngleStart < 0,
          result.movingEdgeResult.blockedCWVerticalAngleEnd < 0);
  }
  TEST_END
}

void rotateTest() {
  TEST_START
  typedef struct {
    bezier_geometry::Shape moving;
    bezier_geometry::Shape stationary;
    bezier_geometry::Point2D fulcrum;
    bool clockwise;
    bezier_geometry::RealNum expectedAngle;
  } RotateTestEntry;
  const std::vector<RotateTestEntry> testEntries(
      {{bezier_geometry::Shape(
            {bezier_geometry::Point2D(1430.6935076093841417,
                                      907.88172487904648733),
             bezier_geometry::Point2D(2600.0000000000022737,
                                      1999.9999999999959073),
             bezier_geometry::Point2D(2873.0295687802367866,
                                      1707.6733769023423974),
             bezier_geometry::Point2D(1703.7230763896218377,
                                      615.55510178139525124)},
            {bezier_geometry::Point2D(2015.3467538046916161,
                                      1453.9408624395209699),
             bezier_geometry::Point2D(2736.5147843901181659,
                                      1853.836688451169266),
             bezier_geometry::Point2D(2288.3763225849274932,
                                      1161.614239341868597),
             bezier_geometry::Point2D(1567.2082919995020802,
                                      761.71841333021916398)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1770.1958422118541421,
                                      1247.9754924540677621),
             bezier_geometry::Point2D(1735.6466919306014915,
                                      1295.5283182688253873),
             bezier_geometry::Point2D(1679.7449924931067926,
                                      1277.3647550686914656),
             bezier_geometry::Point2D(1679.7449924931067926,
                                      1218.5862298394440586),
             bezier_geometry::Point2D(1735.6466919306014915,
                                      1200.4226666393101368)},
            {bezier_geometry::Point2D(1770.1958422118541421,
                                      1284.3026188543356056),
             bezier_geometry::Point2D(1701.0975416493490684,
                                      1306.7540176833151691),
             bezier_geometry::Point2D(1658.3924433368647442,
                                      1247.9754924540677621),
             bezier_geometry::Point2D(1701.097541649348841,
                                      1189.1969672248205825),
             bezier_geometry::Point2D(1770.1958422118541421,
                                      1211.6483660537996911)}),
        bezier_geometry::Point2D(2600, 1999.9999999999952252), true, 0},
       {// Two squares, stationary is in the rotation path with an infinite
        // initial intersection with the moving; adjacent edges are straight
        // lines along the immediate shift direction.
        bezier_geometry::Shape({bezier_geometry::Point2D(10, 10),
                                bezier_geometry::Point2D(11, 10),
                                bezier_geometry::Point2D(11, 11),
                                bezier_geometry::Point2D(10, 11)},
                               {bezier_geometry::Point2D(10.5, 10),
                                bezier_geometry::Point2D(11, 10.5),
                                bezier_geometry::Point2D(10.5, 11),
                                bezier_geometry::Point2D(10, 10.5)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(11, 10),
                                bezier_geometry::Point2D(12, 10),
                                bezier_geometry::Point2D(12, 11),
                                bezier_geometry::Point2D(11, 11)},
                               {bezier_geometry::Point2D(11.5, 10),
                                bezier_geometry::Point2D(12, 10.5),
                                bezier_geometry::Point2D(11.5, 11),
                                bezier_geometry::Point2D(11, 10.5)}),
        bezier_geometry::Point2D(11, 0), true, 0},
       {// Stationary is in the rotation path with an infinite initial
        // intersection; both of stationary's adjacent edges are straight lines
        // along the immediate direction.
        bezier_geometry::Shape({bezier_geometry::Point2D(10, 9),
                                bezier_geometry::Point2D(11, 10),
                                bezier_geometry::Point2D(11, 11),
                                bezier_geometry::Point2D(10, 12)},
                               {bezier_geometry::Point2D(10.5, 9.5),
                                bezier_geometry::Point2D(11, 10.5),
                                bezier_geometry::Point2D(10.5, 11.5),
                                bezier_geometry::Point2D(10, 10.5)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(11, 10),
                                bezier_geometry::Point2D(12, 10),
                                bezier_geometry::Point2D(12, 11),
                                bezier_geometry::Point2D(11, 11)},
                               {bezier_geometry::Point2D(11.5, 10),
                                bezier_geometry::Point2D(12, 10.5),
                                bezier_geometry::Point2D(11.5, 11),
                                bezier_geometry::Point2D(11, 10.5)}),
        bezier_geometry::Point2D(11, 0), true, 0},
       {// Intersection blocks rotation, tests max distance crit interval
        // calculation.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1467.1572875253809798,
                                      1029.8159408569335938),
             bezier_geometry::Point2D(1467.1572875253809798,
                                      1529.8159408569335938),
             bezier_geometry::Point2D(1667.1572875253809798,
                                      1529.8159408569335938),
             bezier_geometry::Point2D(1667.1572875253809798,
                                      1029.8159408569335938)},
            {bezier_geometry::Point2D(1467.1572875253809798,
                                      1279.8159408569335938),
             bezier_geometry::Point2D(1567.1572875253809798,
                                      1529.8159408569335938),
             bezier_geometry::Point2D(1667.1572875253809798,
                                      1279.8159408569335938),
             bezier_geometry::Point2D(1567.1572875253809798,
                                      1029.8159408569335938)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1467.1572875253809798,
                                      1529.8159408569335938),
             bezier_geometry::Point2D(1467.1572875253809798,
                                      2029.8159408569335938),
             bezier_geometry::Point2D(1667.1572875253809798,
                                      2029.8159408569335938),
             bezier_geometry::Point2D(1667.1572875253809798,
                                      1529.8159408569335938)},
            {bezier_geometry::Point2D(1467.1572875253809798,
                                      1779.8159408569335938),
             bezier_geometry::Point2D(1567.1572875253809798,
                                      2029.8159408569335938),
             bezier_geometry::Point2D(1667.1572875253809798,
                                      1779.8159408569335938),
             bezier_geometry::Point2D(1567.1572875253809798,
                                      1529.8159408569335938)}),
        bezier_geometry::Point2D(1667.1572875253809798, 1279.8159408569335938),
        true, 0},
       {// Shapes touch at the endpoint of the moving shape's crit interval;
        // that interval endpoint results in a tiny angle with the stationary,
        // but it is not a block.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1547.8709480176050874,
                                      1477.0436280057892873),
             bezier_geometry::Point2D(1373.5510402372078715,
                                      1945.6720199662356663),
             bezier_geometry::Point2D(1561.0023970213862867,
                                      2015.3999830783945981),
             bezier_geometry::Point2D(1735.32230480178373,
                                      1546.7715911179482191)},
            {bezier_geometry::Point2D(1460.7109941274063658,
                                      1711.3578239860125905),
             bezier_geometry::Point2D(1467.2767186292969654,
                                      1980.5360015223150185),
             bezier_geometry::Point2D(1648.1623509115850084,
                                      1781.0857870981712949),
             bezier_geometry::Point2D(1641.5966264096944087,
                                      1511.9076095618686395)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1501.2756288379086982,
                                      977.04362800578917359),
             bezier_geometry::Point2D(1501.2756288379086982,
                                      1477.0436280057892873),
             bezier_geometry::Point2D(1701.2756288379086982,
                                      1477.0436280057890599),
             bezier_geometry::Point2D(1701.2756288379086982,
                                      977.04362800578917359)},
            {bezier_geometry::Point2D(1501.2756288379086982,
                                      1227.0436280057890599),
             bezier_geometry::Point2D(1601.2756288379086982,
                                      1477.0436280057890599),
             bezier_geometry::Point2D(1701.2756288379086982,
                                      1227.0436280057890599),
             bezier_geometry::Point2D(1601.2756288379086982,
                                      977.04362800578917359)}),
        bezier_geometry::Point2D(1533.1274105804832288, 1803.5080058590610861),
        false, 319.19171458252594675},
       {// Shapes have an infinitely intersecting edge, the infinitely
        // intersecting edges have a common distance crit, thus blocking.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1467.1751972476604351,
                                      979.73997983274534818),
             bezier_geometry::Point2D(1467.1311076753638645,
                                      1479.7399778888550372),
             bezier_geometry::Point2D(1667.1311068978077401,
                                      1479.7576137177736655),
             bezier_geometry::Point2D(1667.1751964701043107,
                                      979.75761566166397643)},
            {bezier_geometry::Point2D(1467.1531524615122635,
                                      1229.7399788608001927),
             bezier_geometry::Point2D(1567.1311072865858023,
                                      1479.7487958033143514),
             bezier_geometry::Point2D(1667.1531516839559117,
                                      1229.757614689718821),
             bezier_geometry::Point2D(1567.1751968588823729,
                                      979.7487977472046623)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1667.1751964701043107,
                                      883.8847011423188178),
             bezier_geometry::Point2D(1667.1751964701043107,
                                      1183.8847011423188178)},
            {bezier_geometry::Point2D(1667.1751964701043107,
                                      1033.8847011423188178),
             bezier_geometry::Point2D(2167.1751964701043107,
                                      1033.8847011423188178)}),
        bezier_geometry::Point2D(1567.1662418492617235, 1081.3035318881211424),
        true, 0.01005360209522741452},
       {// The stationary is in the path of rotation, but its initial
        // intersection is not; this initial intersection is at a transition
        // from irrelevant edges to relevant ones.
        bezier_geometry::Shape({bezier_geometry::Point2D(300, 1900),
                                bezier_geometry::Point2D(900, 1900)},
                               {bezier_geometry::Point2D(600, 1900),
                                bezier_geometry::Point2D(600, 1700)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(300.00000000000005684, 1900),
             bezier_geometry::Point2D(867.5675675675677212,
                                      2094.5945945945945823)},
            {bezier_geometry::Point2D(583.78378378378374691,
                                      1997.2972972972972912),
             bezier_geometry::Point2D(518.91891891891896194,
                                      2186.4864864864866831)}),
        bezier_geometry::Point2D(600, 1950), false, 37.849288832102438107},
       {// Rotation fulcrum is at the touch point between the shapes.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1467.8128203488056442, 1000),
             bezier_geometry::Point2D(1467.8128203488056442, 1500),
             bezier_geometry::Point2D(1667.8128203488056442, 1500),
             bezier_geometry::Point2D(1667.8128203488056442, 1000)},
            {bezier_geometry::Point2D(1467.8128203488056442, 1250),
             bezier_geometry::Point2D(1567.8128203488056442, 1500),
             bezier_geometry::Point2D(1667.8128203488056442, 1250),
             bezier_geometry::Point2D(1567.8128203488056442, 1000)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1417.1572875253809798,
                                      1232.8427124746190202),
             bezier_geometry::Point2D(1464.7101133401386051,
                                      1198.2935621933663697),
             bezier_geometry::Point2D(1446.5465501400046833,
                                      1142.3918627558716707),
             bezier_geometry::Point2D(1387.7680249107572763,
                                      1142.3918627558716707),
             bezier_geometry::Point2D(1369.6044617106233545,
                                      1198.2935621933663697)},
            {bezier_geometry::Point2D(1453.4844139256488234,
                                      1232.8427124746190202),
             bezier_geometry::Point2D(1475.9358127546281594,
                                      1163.7444119121139465),
             bezier_geometry::Point2D(1417.1572875253812072,
                                      1121.0393135996296223),
             bezier_geometry::Point2D(1358.3787622961340276,
                                      1163.7444119121134918),
             bezier_geometry::Point2D(1380.8301611251129088,
                                      1232.8427124746185655)}),
        bezier_geometry::Point2D(1467.8128203488056442, 1180.2033922496170817),
        true, 0},
       {// Blocked by an initial, infinite intersection between 2 non-equivalent
        // edges.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1768.6490149296209893,
                                      1715.4132672973328226),
             bezier_geometry::Point2D(1539.0119455562364692,
                                      1908.4594181773836681)},
            {bezier_geometry::Point2D(1653.8304802429286156,
                                      1811.9363427373582454),
             bezier_geometry::Point2D(1975.5740650430134338,
                                      2194.6647916929991879)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1767.2268064652398607,
                                      1455.3270003319114494),
             bezier_geometry::Point2D(1384.4983575096014192,
                                      1777.0705851319989961),
             bezier_geometry::Point2D(1513.1957914296363015,
                                      1930.1619647142545091),
             bezier_geometry::Point2D(1895.9242403852749703,
                                      1608.4183799141669624)},
            {bezier_geometry::Point2D(1575.8625819874205263,
                                      1616.1987927319553364),
             bezier_geometry::Point2D(1448.8470744696187467,
                                      1853.6162749231268663),
             bezier_geometry::Point2D(1704.5600159074556359,
                                      1769.2901723142106221),
             bezier_geometry::Point2D(1831.5755234252574155,
                                      1531.8726901230390922)}),
        bezier_geometry::Point2D(1737.9025667250441529, 1833.3543751596173479),
        false, 0},
       {// Initial intersection consists of a pair of infinitely intersecting
        // straight lines that touch the fulcrum.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(915.24768452425030318,
                                      375.40392288651639774),
             bezier_geometry::Point2D(915.24768452425041687,
                                      875.40392288651639774),
             bezier_geometry::Point2D(1115.2476845242504169,
                                      875.40392288651628405),
             bezier_geometry::Point2D(1115.2476845242504169,
                                      375.4039228865163409)},
            {bezier_geometry::Point2D(915.24768452425041687,
                                      625.40392288651639774),
             bezier_geometry::Point2D(1015.2476845242504169,
                                      875.40392288651639774),
             bezier_geometry::Point2D(1115.2476845242504169,
                                      625.40392288651628405),
             bezier_geometry::Point2D(1015.2476845242503032,
                                      375.40392288651639774)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1115.2476845242504169,
                                      337.72768159764927987),
             bezier_geometry::Point2D(1115.2476845242504169,
                                      837.72768159764927987),
             bezier_geometry::Point2D(1315.2476845242504169,
                                      837.72768159764927987),
             bezier_geometry::Point2D(1315.2476845242504169,
                                      337.72768159764927987)},
            {bezier_geometry::Point2D(1115.2476845242504169,
                                      587.72768159764927987),
             bezier_geometry::Point2D(1215.2476845242504169,
                                      837.72768159764927987),
             bezier_geometry::Point2D(1315.2476845242504169,
                                      587.72768159764927987),
             bezier_geometry::Point2D(1215.2476845242504169,
                                      337.72768159764927987)}),
        bezier_geometry::Point2D(1115.2476845242504169, 703.61575776689153372),
        false, 0},
       {// The shapes touch along one edge, but that edge does not quite report
        // an infinte initial intersection - also tests some edge cases in root
        // finding.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1924.4902894062674932,
                                      9.9997964307636095782),
             bezier_geometry::Point2D(2024.4902894062674932,
                                      9.9997964307636095782),
             bezier_geometry::Point2D(2024.4902894062674932,
                                      694.95878086271034135),
             bezier_geometry::Point2D(1924.4902894062674932,
                                      694.95878086271034135)},
            {bezier_geometry::Point2D(1974.4902894062674932,
                                      9.9997964307636095782),
             bezier_geometry::Point2D(2024.4902894062674932,
                                      352.4792886467370181),
             bezier_geometry::Point2D(1974.4902894062674932,
                                      694.95878086271034135),
             bezier_geometry::Point2D(1924.4902894062674932,
                                      352.4792886467370181)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1924.4902842321635035,
                                      694.95867301690054774),
             bezier_geometry::Point2D(2024.4902842321635035,
                                      694.95867301690054774),
             bezier_geometry::Point2D(2024.4902842321635035,
                                      1379.9176574488469669),
             bezier_geometry::Point2D(1924.4902842321635035,
                                      1379.9176574488474216)},
            {bezier_geometry::Point2D(1974.4902842321635035,
                                      694.95867301690054774),
             bezier_geometry::Point2D(2024.4902842321635035,
                                      1037.438165232873871),
             bezier_geometry::Point2D(1974.4902842321635035,
                                      1379.9176574488474216),
             bezier_geometry::Point2D(1924.4902842321635035,
                                      1037.438165232873871)}),
        bezier_geometry::Point2D(2024.4902842321630487, 694.95878086271034135),
        true, 0},
       {// 2 rectangles, infinitely interseting on one edge that contains the
        // fulcrum at a corner; the inital intersection does NOT block; tests
        // the conditions for reporting infinite intersections on straight
        // lines.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(810, 9.999983739264223459),
             bezier_geometry::Point2D(910, 9.999983739264223459),
             bezier_geometry::Point2D(910, 1186.3645753155929015),
             bezier_geometry::Point2D(810, 1186.3645753155929015)},
            {bezier_geometry::Point2D(860, 9.999983739264223459),
             bezier_geometry::Point2D(910, 598.18227952742859088),
             bezier_geometry::Point2D(860, 1186.3645753155929015),
             bezier_geometry::Point2D(810, 598.18227952742859088)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(810, 1186.3645753155924467),
             bezier_geometry::Point2D(910, 1186.3645753155924467),
             bezier_geometry::Point2D(910, 2489.9999837392638256),
             bezier_geometry::Point2D(810, 2489.9999837392638256)},
            {bezier_geometry::Point2D(860, 1186.3645753155924467),
             bezier_geometry::Point2D(910, 1838.1822795274281361),
             bezier_geometry::Point2D(860, 2489.9999837392638256),
             bezier_geometry::Point2D(810, 1838.1822795274281361)}),
        bezier_geometry::Point2D(810, 1186.3645753155929015), true, 180},
       {// Initial infinite intersection that is a distance crit of both curves;
        // tests the error tolerance of crit interval matching to prevent a [0,
        // 360] blocked interval.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2050.7326581491670368,
                                      1118.0654223386191006),
             bezier_geometry::Point2D(2150.7326581491670368,
                                      1118.0654223386191006),
             bezier_geometry::Point2D(2150.7326581491670368, 2215),
             bezier_geometry::Point2D(2050.7326581491670368, 2215)},
            {bezier_geometry::Point2D(2100.7326581491670368,
                                      1118.0654223386191006),
             bezier_geometry::Point2D(2150.7326581491670368,
                                      1666.5327111693095503),
             bezier_geometry::Point2D(2100.7326581491670368, 2215),
             bezier_geometry::Point2D(2050.7326581491670368,
                                      1666.5327111693095503)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1950.7326593118395976, 2490),
             bezier_geometry::Point2D(2250.7326593118395976, 2490),
             bezier_geometry::Point2D(2250.7326593118395976, 2190),
             bezier_geometry::Point2D(2150.7326593118395976, 2190),
             bezier_geometry::Point2D(2150.7326593118395976, 2390),
             bezier_geometry::Point2D(1950.7326593118395976, 2390)},
            {bezier_geometry::Point2D(2100.7326593118395976, 2490),
             bezier_geometry::Point2D(2250.7326593118395976, 2340),
             bezier_geometry::Point2D(2200.7326593118395976, 2190),
             bezier_geometry::Point2D(2150.7326593118395976, 2290),
             bezier_geometry::Point2D(2050.7326593118395976, 2390),
             bezier_geometry::Point2D(1950.7326593118395976, 2440)}),
        bezier_geometry::Point2D(2050.7326581491670368, 2190), true, 0},
       {// Infinite initial intersection between an edge on each shape, the
        // fulcrum lies within that infinite intersection.  Tests the output
        // blocked intervals.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2358.9629933952219289,
                                      310.71643166624153309),
             bezier_geometry::Point2D(2458.9629933952219289,
                                      310.71643166624153309),
             bezier_geometry::Point2D(2458.9629933952219289,
                                      2240.7164316662415331),
             bezier_geometry::Point2D(2358.9629933952219289,
                                      2240.7164316662415331)},
            {bezier_geometry::Point2D(2408.9629933952219289,
                                      310.71643166624153309),
             bezier_geometry::Point2D(2458.9629933952219289,
                                      1275.7164316662415331),
             bezier_geometry::Point2D(2408.9629933952219289,
                                      2240.7164316662415331),
             bezier_geometry::Point2D(2358.9629933952219289,
                                      1275.7164316662415331)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2258.9629933952219289, 2490),
             bezier_geometry::Point2D(2558.9629933952219289, 2490),
             bezier_geometry::Point2D(2558.9629933952219289, 2190),
             bezier_geometry::Point2D(2458.9629933952219289, 2190),
             bezier_geometry::Point2D(2458.9629933952219289, 2390),
             bezier_geometry::Point2D(2258.9629933952219289, 2390)},
            {bezier_geometry::Point2D(2408.9629933952219289, 2490),
             bezier_geometry::Point2D(2558.9629933952219289, 2340),
             bezier_geometry::Point2D(2508.9629933952219289, 2190),
             bezier_geometry::Point2D(2458.9629933952219289, 2290),
             bezier_geometry::Point2D(2358.9629933952219289, 2390),
             bezier_geometry::Point2D(2258.9629933952219289, 2440)}),
        bezier_geometry::Point2D(2458.9629933952219289, 2190.0270102377116928),
        true, 0},
       {// Just barely no initial intersection between edges that will block,
        // the blocking edge pair have ALMOST identical endpoints; tests the
        // distance matching logic in curves.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(929.31079364305128365,
                                      1589.9998238479374777),
             bezier_geometry::Point2D(1129.3107936430153586,
                                      1589.9999438178788296),
             bezier_geometry::Point2D(1129.3103137632499511,
                                      2389.9999438177346747),
             bezier_geometry::Point2D(929.31031376328598981,
                                      2389.9998238477937775)},
            {bezier_geometry::Point2D(1029.3107936430333211,
                                      1589.9998838329081536),
             bezier_geometry::Point2D(1129.3105537031326548,
                                      1989.9999438178067521),
             bezier_geometry::Point2D(1029.3103137632679136,
                                      2389.9998838327642261),
             bezier_geometry::Point2D(929.31055370316869357,
                                      1989.9998238478656276)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(929.31043373315787903, 2490),
             bezier_geometry::Point2D(1229.310433733157879, 2490),
             bezier_geometry::Point2D(1229.310433733157879, 2190),
             bezier_geometry::Point2D(1129.310433733157879, 2190),
             bezier_geometry::Point2D(1129.310433733157879, 2390),
             bezier_geometry::Point2D(929.31043373315787903, 2390)},
            {bezier_geometry::Point2D(1079.310433733157879, 2490),
             bezier_geometry::Point2D(1229.310433733157879, 2340),
             bezier_geometry::Point2D(1179.310433733157879, 2190),
             bezier_geometry::Point2D(1129.310433733157879, 2290),
             bezier_geometry::Point2D(1029.310433733157879, 2390),
             bezier_geometry::Point2D(929.31043373315787903, 2440)}),
        bezier_geometry::Point2D(1099.6435221492959045, 2279.3299339709737978),
        true, 5.9253163963821900082e-5},
       {// Any initial intersection does not block, but the edges that do
        // eventually block ALMOST touch at the fulcrum.  Tests finding equation
        // roots near 0.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1631.4133503637340254,
                                      109.99999999999985789),
             bezier_geometry::Point2D(1731.4133503637340254,
                                      109.99999999999985789),
             bezier_geometry::Point2D(1731.4133503637340254, 2140),
             bezier_geometry::Point2D(1631.4133503637340254, 2140)},
            {bezier_geometry::Point2D(1681.4133503637340254,
                                      109.99999999999985789),
             bezier_geometry::Point2D(1731.4133503637340254,
                                      1124.9999999999997726),
             bezier_geometry::Point2D(1681.4133503637340254, 2140),
             bezier_geometry::Point2D(1631.4133503637340254,
                                      1124.9999999999997726)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(931.41335018260667766,
                                      2340.0410969378917798),
             bezier_geometry::Point2D(931.40307588215796386,
                                      2140.0410972017948552),
             bezier_geometry::Point2D(1731.4030748265454349, 2140),
             bezier_geometry::Point2D(1731.413349126994035,
                                      2339.9999997360969246)},
            {bezier_geometry::Point2D(931.40821303238226392,
                                      2240.0410970698435449),
             bezier_geometry::Point2D(1331.4030753543515857,
                                      2140.0205486008972002),
             bezier_geometry::Point2D(1731.408211976769735,
                                      2239.9999998680482349),
             bezier_geometry::Point2D(1331.4133496548004132,
                                      2340.0205483369941248)}),
        bezier_geometry::Point2D(1731.4030748265458897, 2140), false,
        89.9970566297331942},
       {// The edges that will block intersect at their endpoints and are very
        // close to infinitely intersecting; tests the 'intersection blocks
        // rotate' logic.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(843.06384652658334744, 260),
             bezier_geometry::Point2D(943.06384652658334744, 260),
             bezier_geometry::Point2D(943.06384652658334744, 2390),
             bezier_geometry::Point2D(843.06384652658334744, 2390),
             bezier_geometry::Point2D(843.06384652658334744,
                                      1057.5633089512416518),
             bezier_geometry::Point2D(893.06384652658334744,
                                      1057.5633089512414244),
             bezier_geometry::Point2D(893.06384652658334744,
                                      807.56330895124153813),
             bezier_geometry::Point2D(843.06384652658334744,
                                      807.56330895124153813)},
            {bezier_geometry::Point2D(893.06384652658334744, 260),
             bezier_geometry::Point2D(943.06384652658334744, 1325),
             bezier_geometry::Point2D(893.06384652658334744, 2390),
             bezier_geometry::Point2D(843.06384652658334744,
                                      1723.7816544756208259),
             bezier_geometry::Point2D(868.06384652658334744,
                                      1057.5633089512414244),
             bezier_geometry::Point2D(893.06384652658334744,
                                      932.56330895124153813),
             bezier_geometry::Point2D(868.06384652658334744,
                                      807.56330895124153813),
             bezier_geometry::Point2D(843.06384652658334744,
                                      533.78165447562071222)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(893.06384652658266532,
                                      807.56334948780988725),
             bezier_geometry::Point2D(893.06368438030915513,
                                      1007.5633494877441763),
             bezier_geometry::Point2D(93.0636843805719991,
                                      1007.5627009026501355),
             bezier_geometry::Point2D(93.063846526845509288,
                                      807.5627009027158465)},
            {bezier_geometry::Point2D(893.06376545344585338,
                                      907.56334948777703175),
             bezier_geometry::Point2D(493.06368438044057712,
                                      1007.5630251951971559),
             bezier_geometry::Point2D(93.063765453708697351,
                                      907.562700902682991),
             bezier_geometry::Point2D(493.0638465267140873,
                                      807.56302519526286687)}),
        bezier_geometry::Point2D(943.06384652658289269, 310), false, 0},
       {// Intersection at the fulcrum, but one curve's point is not quite as
        // close due to it using some endpoint matching leeway.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2301.6444128547832406,
                                      2395.575054510505197),
             bezier_geometry::Point2D(2125.3380113813950629,
                                      2489.9999071686079333),
             bezier_geometry::Point2D(1747.6386007489834356,
                                      1784.7743012750549951),
             bezier_geometry::Point2D(1923.9450022223716132,
                                      1690.3494486169520314)},
            {bezier_geometry::Point2D(2213.4912121180891518,
                                      2442.7874808395567925),
             bezier_geometry::Point2D(1936.4883060651891356,
                                      2137.3871042218315779),
             bezier_geometry::Point2D(1835.7918014856775244,
                                      1737.561874946003627),
             bezier_geometry::Point2D(2112.7947075385773132,
                                      2042.9622515637283868)}),
        bezier_geometry::Shape({bezier_geometry::Point2D(0, 2490),
                                bezier_geometry::Point2D(4102, 2490),
                                bezier_geometry::Point2D(4102, 2500),
                                bezier_geometry::Point2D(0, 2500)},
                               {bezier_geometry::Point2D(2051, 2490),
                                bezier_geometry::Point2D(4102, 2495),
                                bezier_geometry::Point2D(2051, 2500),
                                bezier_geometry::Point2D(0, 2495)}),
        bezier_geometry::Point2D(2125.3380610993317532, 2490), true,
        61.827724357141107703},
       {
           // Intersection at the fulcrum, but one curve's point is not quite as
           // close due to it using some endpoint matching leeway.
           bezier_geometry::Shape(
               {bezier_geometry::Point2D(2588.5556089939891535,
                                         1457.701075731579067),
                bezier_geometry::Point2D(2675.2370839971499663,
                                         1407.8380444230397188),
                bezier_geometry::Point2D(2949.2013021058151025,
                                         1884.0951411246555836),
                bezier_geometry::Point2D(2862.519827102653835,
                                         1933.9581724331949317)},
               {bezier_geometry::Point2D(2631.8963464955695599,
                                         1432.7695600773092792),
                bezier_geometry::Point2D(2812.2191930514827618,
                                         1645.9665927738476512),
                bezier_geometry::Point2D(2905.8605646042342414,
                                         1909.026656778925144),
                bezier_geometry::Point2D(2725.5377180483214943,
                                         1695.8296240823869994)}),
           bezier_geometry::Shape(
               {bezier_geometry::Point2D(2886.5052515201473398,
                                         1927.5597075388045596),
                bezier_geometry::Point2D(2886.5052515201473398,
                                         2027.5597075388045596)},
               {bezier_geometry::Point2D(2886.5052515201473398,
                                         1977.5597075388045596),
                bezier_geometry::Point2D(2686.5052515201473398,
                                         1977.5597075388045596)}),
           bezier_geometry::Point2D(2862.5239582133153817,
                                    1933.965353921286578),
           true, 76.090391455444944313
           // 76.089993836995219567
       },
       {// Fulcrum is inside the infinitely intersecting portion of a pair of
        // straight line edges; infinitely intersecting edges don't quite touch
        // due to being extremely close parallel lines, so an angle is reported
        // (as it should be).
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1564.4044654461474693,
                                      1351.3327166103915715),
             bezier_geometry::Point2D(1680.2078829851120645,
                                      1514.3957979203441937),
             bezier_geometry::Point2D(1027.955557745301121,
                                      1977.6094680762021198),
             bezier_geometry::Point2D(912.15214020633652581,
                                      1814.5463867662494977)},
            {bezier_geometry::Point2D(1622.3061742156296532,
                                      1432.8642572653679963),
             bezier_geometry::Point2D(1354.0817203652063654,
                                      1746.0026329982733841),
             bezier_geometry::Point2D(970.05384897581870973,
                                      1896.0779274212259224),
             bezier_geometry::Point2D(1238.2783028262419975,
                                      1582.9395516883205346)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2372.1701680340274834,
                                      796.2260030189685267),
             bezier_geometry::Point2D(2574.8261487272143313,
                                      1081.5863953113864682),
             bezier_geometry::Point2D(1775.8170503084436405,
                                      1649.0231412523098697),
             bezier_geometry::Point2D(1573.1610696152567925,
                                      1363.6627489598918146),
             bezier_geometry::Point2D(1613.9268399427451186,
                                      1334.7118945751508363),
             bezier_geometry::Point2D(1787.6319662511909883,
                                      1579.3065165400805654),
             bezier_geometry::Point2D(2505.1095240149847996,
                                      1069.7714793686391204),
             bezier_geometry::Point2D(2331.4043977065389299,
                                      825.17685740370950498)},
            {bezier_geometry::Point2D(2473.49815838062068,
                                      938.90619916517755428),
             bezier_geometry::Point2D(2175.3215995178288722,
                                      1365.3047682818480553),
             bezier_geometry::Point2D(1674.4890599618502165,
                                      1506.3429451061008422),
             bezier_geometry::Point2D(1593.5439547790008419,
                                      1349.1873217675213255),
             bezier_geometry::Point2D(1700.7794030969680534,
                                      1457.0092055576155872),
             bezier_geometry::Point2D(2146.3707451330878939,
                                      1324.5389979543597292),
             bezier_geometry::Point2D(2418.2569608607618648,
                                      947.47416838617436952),
             bezier_geometry::Point2D(2351.7872828702829793,
                                      810.70143021133901584)}),
        bezier_geometry::Point2D(1674.4890599618504439, 1506.3429451061012969),
        true, 0.0005503155728376838687},
       {// Non-infinite, non-endpoint intersection, at fulcrum, same slope.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2320.6334134478674969,
                                      226.2603488078261762),
             bezier_geometry::Point2D(2386.6916757969438549,
                                      151.18501347443833538),
             bezier_geometry::Point2D(3911.2416431010192355,
                                      1492.6258642842014979),
             bezier_geometry::Point2D(3845.1833807519433321,
                                      1567.7011996175892818)},
            {bezier_geometry::Point2D(2353.6625446224056759,
                                      188.72268114113225579),
             bezier_geometry::Point2D(3148.9666594489813178,
                                      821.90543887931994504),
             bezier_geometry::Point2D(3878.2125119264810564,
                                      1530.1635319508952762),
             bezier_geometry::Point2D(3082.9083970999054145,
                                      896.98077421270772902)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2737.2608612032718156,
                                      314.55595041571746151),
             bezier_geometry::Point2D(2737.2608612032718156,
                                      414.55595041571746151)},
            {bezier_geometry::Point2D(2737.2608612032718156,
                                      364.55595041571746151),
             bezier_geometry::Point2D(2537.2608612032718156,
                                      364.55595041571746151)}),
        bezier_geometry::Point2D(2645.3335938919490218, 378.76222780344096464),
        true, 0},
       {// Multiple infinite initial intersections.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3285.1619252182595119,
                                      115.89891953553039627),
             bezier_geometry::Point2D(3385.1087121772411592,
                                      112.6370524971746363),
             bezier_geometry::Point2D(3410.4705733420564684,
                                      889.7492109378282521),
             bezier_geometry::Point2D(3310.5237863830748211,
                                      893.01107797618408313),
             bezier_geometry::Point2D(3297.1618900486428174,
                                      483.58954405042618419),
             bezier_geometry::Point2D(3347.1352835281336411,
                                      481.95861053124832551),
             bezier_geometry::Point2D(3338.9806159322442909,
                                      232.09164313379386613),
             bezier_geometry::Point2D(3289.0072224527534672,
                                      233.72257665297175322)},
            {bezier_geometry::Point2D(3335.1353186977503356,
                                      114.26798601635252339),
             bezier_geometry::Point2D(3397.7896427596488138,
                                      501.19313171750150104),
             bezier_geometry::Point2D(3360.4971798625656447,
                                      891.38014445700616761),
             bezier_geometry::Point2D(3303.8428382158585919,
                                      688.30031101330507681),
             bezier_geometry::Point2D(3322.1485867883880019,
                                      482.77407729083722643),
             bezier_geometry::Point2D(3343.0579497301887386,
                                      357.02512683252109582),
             bezier_geometry::Point2D(3313.9939191924986517,
                                      232.90710989338282388),
             bezier_geometry::Point2D(3287.0845738355064896,
                                      174.81074809425109606)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3085.0755560176035033,
                                      116.52380554741625929),
             bezier_geometry::Point2D(3284.9691276030334848,
                                      110.00000000000001421),
             bezier_geometry::Point2D(3311.0643497926985219,
                                      909.57428634172072179),
             bezier_geometry::Point2D(3111.1707782072685404,
                                      916.09809188913698108)},
            {bezier_geometry::Point2D(3185.0223418103187214,
                                      113.26190277370814385),
             bezier_geometry::Point2D(3298.0167386978660033,
                                      509.7871431708603609),
             bezier_geometry::Point2D(3211.1175639999837585,
                                      912.83618911542885144),
             bezier_geometry::Point2D(3098.1231671124360219,
                                      516.31094871827667703)}),
        bezier_geometry::Point2D(3310.5237863830748211, 893.01107797618408313),
        true, 0},
       {// Fulcrum is at an endpoint of one curve and very close to an endpoint
        // (but not matching) the other shape's curve.  Tests the 'params for
        // distance' functionality.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1287.8827482468550443,
                                      119.39751978951107958),
             bezier_geometry::Point2D(1615.6390902280545561,
                                      621.96669939675985006)},
            {bezier_geometry::Point2D(1451.7609192374548002,
                                      370.68210959313546482),
             bezier_geometry::Point2D(1535.5224491719961861,
                                      316.05605259626884163)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1615.6389437777997955,
                                      621.96647483547769752),
             bezier_geometry::Point2D(1615.6390901943850622,
                                      821.96647483542415102),
             bezier_geometry::Point2D(815.63909019459936189,
                                      821.96706050176499048),
             bezier_geometry::Point2D(815.63894377801409519,
                                      621.96706050181853698)},
            {bezier_geometry::Point2D(1615.6390169860924289,
                                      721.96647483545086743),
             bezier_geometry::Point2D(1215.6390901944921552,
                                      821.96676766859445706),
             bezier_geometry::Point2D(815.63901698630672854,
                                      721.96706050179182057),
             bezier_geometry::Point2D(1215.6389437779071159,
                                      621.96676766864811725)}),
        bezier_geometry::Point2D(1615.6390902280545561, 621.96669939675985006),
        false, 194.70606312819018058},
       {// Just barely no initial intersection, eventual block is between 2
        // straight lines whose slope is just barely different enough to not
        // intersect infinitely.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(810.00029999625314758,
                                      837.33120919103441793),
             bezier_geometry::Point2D(810.0000340705751114,
                                      1037.3312091908574075),
             bezier_geometry::Point2D(10.000034071282243531,
                                      1037.3301454881452628),
             bezier_geometry::Point2D(10.000299996960279714,
                                      837.33014548832215951)},
            {bezier_geometry::Point2D(810.00016703341407265,
                                      937.33120919094608325),
             bezier_geometry::Point2D(410.00003407092867747,
                                      1037.3306773395013352),
             bezier_geometry::Point2D(10.000167034121204779,
                                      937.33014548823382484),
             bezier_geometry::Point2D(410.00029999660671365,
                                      837.33067733967834556)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(-643.18735677134463913,
                                      1037.331209190809659),
             bezier_geometry::Point2D(156.81264322865536087,
                                      1037.331209190809659),
             bezier_geometry::Point2D(156.81264322865536087,
                                      1087.331209190809659),
             bezier_geometry::Point2D(-643.18735677134463913,
                                      1087.331209190809659)},
            {bezier_geometry::Point2D(-243.18735677134463913,
                                      1037.331209190809659),
             bezier_geometry::Point2D(156.81264322865536087,
                                      1062.331209190809659),
             bezier_geometry::Point2D(-243.18735677134463913,
                                      1087.331209190809659),
             bezier_geometry::Point2D(-643.18735677134463913,
                                      1062.331209190809659)}),
        bezier_geometry::Point2D(810.00029999625269284, 837.33120919103419055),
        true, 7.6182075402465694266e-5},
       {// Two edges almost intersect at the fulcrum.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2505.6556683154776692, 60),
             bezier_geometry::Point2D(2695.2288323764705638,
                                      629.26445125960913174)},
            {bezier_geometry::Point2D(2600.4422503459741165,
                                      344.63222562980456587),
             bezier_geometry::Point2D(2695.3196588892419641,
                                      313.03669828630575012)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2695.2288758507584134, 360),
             bezier_geometry::Point2D(2745.2288758507584134, 360),
             bezier_geometry::Point2D(2745.2288758507584134, 2490),
             bezier_geometry::Point2D(2695.2288758507584134, 2490)},
            {bezier_geometry::Point2D(2720.2288758507584134, 360),
             bezier_geometry::Point2D(2745.2288758507584134, 1425),
             bezier_geometry::Point2D(2720.2288758507584134, 2490),
             bezier_geometry::Point2D(2695.2288758507584134, 1425)}),
        bezier_geometry::Point2D(2695.2288323764705638, 629.26445125960913174),
        true, 161.58151174536652661},
       {// Two edges intersect at the fulcrum with sufficiently different
        // slopes; tests the early return logic for fulcrum intersections since
        // the distance/angular slope search will not yield a result.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2838.6804538324859095,
                                      2430.3660541144517993),
             bezier_geometry::Point2D(3124.3329545556266567,
                                      1909.6720539621453554)},
            {bezier_geometry::Point2D(2981.506704194055601,
                                      2170.019054038298691),
             bezier_geometry::Point2D(3069.1800904968122268,
                                      2218.1166354141601005)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3124.3755789731831101,
                                      1909.5943571857326333),
             bezier_geometry::Point2D(3028.1804162214566531,
                                      2084.9411297912438386),
             bezier_geometry::Point2D(2326.7933257994118321,
                                      1700.1604787843375561),
             bezier_geometry::Point2D(2422.988488551138289,
                                      1524.8137061788265783)},
            {bezier_geometry::Point2D(3076.2779975973198816,
                                      1997.2677434884881222),
             bezier_geometry::Point2D(2677.4868710104342426,
                                      1892.5508042877906973),
             bezier_geometry::Point2D(2374.8909071752750606,
                                      1612.4870924815822946),
             bezier_geometry::Point2D(2773.6820337621606996,
                                      1717.2040316822797195)}),
        bezier_geometry::Point2D(3124.332955360959204, 1909.6720494582941683),
        true, 161.38874356113831254},
       {// Two edges intersect at the fulcrum with sufficiently different
        // slopes; tests the early return logic for fulcrum intersections since
        // the distance/angular slope search will not yield a result.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3031.0222203713442468,
                                      374.05644612076093836),
             bezier_geometry::Point2D(3643.2312199500679526,
                                      374.05572983147521882)},
            {bezier_geometry::Point2D(3337.1267201607060997,
                                      374.05608797611813543),
             bezier_geometry::Point2D(3337.1268371614828538,
                                      474.05608797604958227)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3644.2310341214142682, 10),
             bezier_geometry::Point2D(3644.2310341214142682,
                                      416.91136736313387701),
             bezier_geometry::Point2D(3643.2310341214142682,
                                      416.91136736313387701),
             bezier_geometry::Point2D(3643.2310341214142682, 10)},
            {bezier_geometry::Point2D(3644.2310341214142682,
                                      213.4556836815669385),
             bezier_geometry::Point2D(3643.7310341214142682,
                                      416.91136736313387701),
             bezier_geometry::Point2D(3643.2310341214142682,
                                      213.4556836815669385),
             bezier_geometry::Point2D(3643.7310341214142682, 10)}),
        bezier_geometry::Point2D(3643.2310341214147229, 374.05579040257498491),
        true, 71.908462120641956972},
       {// Small distance overlap, but not at the initial intersection.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(4142, 1675.0074805715155435),
             bezier_geometry::Point2D(4500.4703185870030211,
                                      381.52386708385006386)},
            {bezier_geometry::Point2D(4321.2351592935019653,
                                      1028.2656738276828037),
             bezier_geometry::Point2D(4417.6028928087653185,
                                      1054.9726005908128172)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(4505.4703185870030211, 10),
             bezier_geometry::Point2D(4505.4703185870030211,
                                      382.91996218305951061),
             bezier_geometry::Point2D(4500.4703185870030211,
                                      382.91996218305951061),
             bezier_geometry::Point2D(4500.4703185870030211, 10)},
            {bezier_geometry::Point2D(4505.4703185870030211,
                                      196.4599810915297553),
             bezier_geometry::Point2D(4502.9703185870030211,
                                      382.91996218305951061),
             bezier_geometry::Point2D(4500.4703185870030211,
                                      196.4599810915297553),
             bezier_geometry::Point2D(4502.9703185870030211, 10)}),
        bezier_geometry::Point2D(4142, 1675.0074805715155435), true,
        359.77840212019128785},
       {// Moving is a straight line that forms a tangent to the rotation circle
        // at the point of intersection - requires refining of the result of the
        // reduced intersection equation to get accurate results.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1976.9673836123381534,
                                      1151.6555126832022324),
             bezier_geometry::Point2D(1189.5816329259971553,
                                      1293.1605642400543275)},
            {bezier_geometry::Point2D(1583.2745082691676544,
                                      1222.4080384616281663),
             bezier_geometry::Point2D(1189.5816329259971553,
                                      1151.6555126832022324)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2203.1488260676605933,
                                      1150.6358531637379201),
             bezier_geometry::Point2D(1754.0041866468561693,
                                      1235.894034060096601)},
            {bezier_geometry::Point2D(1963.2058659852721121,
                                      1112.2915912020789619),
             bezier_geometry::Point2D(2203.1488260676605933,
                                      1235.894034060096601)}),
        bezier_geometry::Point2D(1941.5911207231245044, 954.80907501161664186),
        true, 0},
       {// Rotation about a corner of each shape; tests the constant equation
        // functionality of PolynomialFunction::solveSystem.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2491.7411399039174285,
                                      1531.5072302202447645),
             bezier_geometry::Point2D(3223.5591129522385927,
                                      1531.506541587572201)},
            {bezier_geometry::Point2D(2857.6501264280777832,
                                      1531.5068859039081417),
             bezier_geometry::Point2D(2857.6502205269794104,
                                      1631.5068859038642586)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3323.5591129522390474,
                                      1813.6728627957822937),
             bezier_geometry::Point2D(3323.5591129522390474,
                                      1087.4104095378006605),
             bezier_geometry::Point2D(3223.5591129522390474,
                                      1087.4104095378006605),
             bezier_geometry::Point2D(3223.5591129522390474,
                                      1531.5065415875726558),
             bezier_geometry::Point2D(3273.5591129522390474,
                                      1531.5065415875726558),
             bezier_geometry::Point2D(3273.5591129522390474,
                                      1813.6728627957822937)},
            {bezier_geometry::Point2D(3323.5591129522390474,
                                      1450.5416361667914771),
             bezier_geometry::Point2D(3273.5591129522390474,
                                      1087.4104095378006605),
             bezier_geometry::Point2D(3223.5591129522390474,
                                      1309.4584755626865444),
             bezier_geometry::Point2D(3248.5591129522390474,
                                      1531.5065415875726558),
             bezier_geometry::Point2D(3273.5591129522390474,
                                      1672.5897021916775884),
             bezier_geometry::Point2D(3298.5591129522390474,
                                      1813.6728627957822937)}),
        bezier_geometry::Point2D(3214.2384039766566275, 1531.5065415875728831),
        true, 92.279869707748929386},
       {
           // A pair of edges intersect, but not quite at the fulcrum; the
           // overlap is too small to cause a block so the aligned distance crit
           // at the fulcrum with unequal slopes case must be used.
           bezier_geometry::Shape(
               {bezier_geometry::Point2D(1900.6363634844428816,
                                         950.19833781816384999),
                bezier_geometry::Point2D(3770.9789979646843676,
                                         950.19593548869511324)},
               {bezier_geometry::Point2D(2835.8076807245633972,
                                         950.19713665342942477),
                bezier_geometry::Point2D(2835.8078091678462442,
                                         1050.1971366533468881)}),
           bezier_geometry::Shape(
               {bezier_geometry::Point2D(3775.978609882110959,
                                         750.1958577284938201),
                bezier_geometry::Point2D(3775.9788846032688525,
                                         950.19585772830509995),
                bezier_geometry::Point2D(2975.9788846040237331,
                                         950.19695661293667399),
                bezier_geometry::Point2D(2975.9786098828653849,
                                         750.19695661312528046)},
               {bezier_geometry::Point2D(3775.9787472426896784,
                                         850.19585772839946003),
                bezier_geometry::Point2D(3375.9788846036462928,
                                         950.19640717062088697),
                bezier_geometry::Point2D(2975.978747243444559,
                                         850.19695661303103407),
                bezier_geometry::Point2D(3375.9786098824883993,
                                         750.19640717080960712)}),
           bezier_geometry::Point2D(3770.9788870568959283,
                                    950.19594735130885965),
           true,
           // 173.8964308466036357
           35.979861355443766513 // Invalidated case - updated logic means the
                                 // tiny overlap qualifies as a 'magnitude
                                 // edge' case and blocks earlier.
       },
       {// The edge at the end of a relevance interval in the moving shape has
        // nearly identical magnitudes, causing the next edge to be used; tests
        // the parameters used for equivalent magnitude in the stationary edge.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3721.5562647657175148,
                                      1878.8396941956107185),
             bezier_geometry::Point2D(3703.1110369734583401,
                                      1692.8849055832952217),
             bezier_geometry::Point2D(3520.5576346745028786,
                                      1652.9641698030652606),
             bezier_geometry::Point2D(3426.1786550840738528,
                                      1814.2465868472945658),
             bezier_geometry::Point2D(3550.4026401726123368,
                                      1953.8453381485933278)},
            {bezier_geometry::Point2D(3779.8856819761354018,
                                      1779.1616786745412355),
             bezier_geometry::Point2D(3626.3363919707812784,
                                      1606.6081324920485258),
             bezier_geometry::Point2D(3414.7788773782235694,
                                      1699.3202071140815406),
             bezier_geometry::Point2D(3437.5784327899241362,
                                      1929.1729665805073637),
             bezier_geometry::Point2D(3663.2268475552996279,
                                      1978.5177097166802014)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3649.6154544979817729,
                                      1104.8494398243956311),
             bezier_geometry::Point2D(3699.6154544979817729,
                                      1104.8494398243956311),
             bezier_geometry::Point2D(3699.6154544979817729,
                                      1647.4247199121978156),
             bezier_geometry::Point2D(3649.6154544979817729,
                                      1647.4247199121978156)},
            {bezier_geometry::Point2D(3674.6154544979817729,
                                      1104.8494398243956311),
             bezier_geometry::Point2D(3699.6154544979817729,
                                      1376.1370798682967234),
             bezier_geometry::Point2D(3674.6154544979817729,
                                      1647.4247199121978156),
             bezier_geometry::Point2D(3649.6154544979817729,
                                      1376.1370798682967234)}),
        bezier_geometry::Point2D(3649.6154544979822276, 1947.4247199121978156),
        false, 1.2585353293449172973},
       {// Best solution is at an endpoint, but that endpoint is just slightly
        // closer than any point on the other curve - tests the 'aligned
        // distance crit' functionality for non-fulcrum curve endpoints.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3346.8200120819778931,
                                      1666.8792253598132902),
             bezier_geometry::Point2D(3347.1328432805767079,
                                      1866.8789807012665278),
             bezier_geometry::Point2D(2547.1338219147633026,
                                      1868.1303054956617871),
             bezier_geometry::Point2D(2546.8209907161644878,
                                      1668.1305501542085494)},
            {bezier_geometry::Point2D(3346.9764276812770731,
                                      1766.879103030539909),
             bezier_geometry::Point2D(2947.1333325976702326,
                                      1867.5046430984641574),
             bezier_geometry::Point2D(2546.9774063154641226,
                                      1768.1304278249351682),
             bezier_geometry::Point2D(2946.8205013990714178,
                                      1667.5048877570109198)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3589.6667638899798476,
                                      1484.6641105768865145),
             bezier_geometry::Point2D(3087.5235688333959843,
                                      1667.2848103313046977)},
            {bezier_geometry::Point2D(3338.5951663616879159,
                                      1575.9744604540953787),
             bezier_geometry::Point2D(3304.4170294583136638,
                                      1481.9965111371723196)}),
        bezier_geometry::Point2D(3087.65903815637148, 1767.2847163756366626),
        false, 0.01200134339731174539},
       {// Odd case in finding curve distance parameters.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1317.3875391135104564,
                                      1328.3770574870477503),
             bezier_geometry::Point2D(1518.3033109333928223,
                                      1786.233861121132577),
             bezier_geometry::Point2D(1701.4460323870268894,
                                      1705.8675523931797215),
             bezier_geometry::Point2D(1500.5302605671442961,
                                      1248.0107487590946675)},
            {bezier_geometry::Point2D(1417.8454250234517531,
                                      1557.3054593040901636),
             bezier_geometry::Point2D(1609.8746716602099696,
                                      1746.0507067571561493),
             bezier_geometry::Point2D(1600.9881464770855928,
                                      1476.9391505761373082),
             bezier_geometry::Point2D(1408.9588998403273763,
                                      1288.1939031230713226)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(1585.6936680644132593,
                                      1234.1587806225272743),
             bezier_geometry::Point2D(1624.9643723907913682,
                                      1531.5773607107762473)},
            {bezier_geometry::Point2D(1605.3290202276023138,
                                      1382.8680706666518745),
             bezier_geometry::Point2D(2101.0266537080169655,
                                      1317.416896789355178)}),
        bezier_geometry::Point2D(1624.9643723907913682, 1531.5773607107762473),
        true, 90.528255723417132117},
       {// Odd case in getting curve parameters for a fulcrum distance.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2678.5140616084909198,
                                      1346.2479643619158196),
             bezier_geometry::Point2D(2783.7397017319667611,
                                      1293.8339893828529057),
             bezier_geometry::Point2D(2766.407560325333634,
                                      1177.5616496508187083),
             bezier_geometry::Point2D(2650.4700677147393435,
                                      1158.1153667240100731),
             bezier_geometry::Point2D(2596.1488981175853041,
                                      1262.3692426524298753)},
            {bezier_geometry::Point2D(2750.1673726122776316,
                                      1358.2664281655304421),
             bezier_geometry::Point2D(2817.312030851655436,
                                      1229.4015506001755966),
             bezier_geometry::Point2D(2715.5030897990127414,
                                      1125.7217487014622748),
             bezier_geometry::Point2D(2585.4370456304673098,
                                      1190.5089847465574167),
             bezier_geometry::Point2D(2606.8607506047042079,
                                      1334.2295005583014245)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3291.0805378192326316,
                                      1627.8541238369034545),
             bezier_geometry::Point2D(2760.2927935718062145,
                                      1325.4985088068665391)},
            {bezier_geometry::Point2D(3025.6866656955198778,
                                      1476.6763163218852242),
             bezier_geometry::Point2D(2976.190259276389952,
                                      1563.5676608367004974)}),
        bezier_geometry::Point2D(2760.2927935718062145, 1325.4985088068665391),
        true, 89.415172562796684019},
       {
           // Aligned distance crit condition results in a smaller angle than
           // what would be found in the standard search.  Tests that if the
           // 'aligned distance crit' condition is found to be invalid, a larger
           // angle from the normal search would be accepted.
           bezier_geometry::Shape(
               {bezier_geometry::Point2D(1679.7633834517118885,
                                         1246.2818475039844088),
                bezier_geometry::Point2D(1947.9348802009265,
                                         1111.8049040107375731)},
               {bezier_geometry::Point2D(1813.8491318263193079,
                                         1179.043375757360991),
                bezier_geometry::Point2D(1589.7208926709076877,
                                         732.0908811753364489)}),
           bezier_geometry::Shape(
               {bezier_geometry::Point2D(1430.648111492789667,
                                         833.47923333053768147),
                bezier_geometry::Point2D(1484.312142575165808,
                                         1330.5910635739846839),
                bezier_geometry::Point2D(1683.1568746725447454,
                                         1309.1254511410343184),
                bezier_geometry::Point2D(1629.4928435901686044,
                                         812.01362089758720231)},
               {bezier_geometry::Point2D(1457.4801270339776238,
                                         1082.0351484522611827),
                bezier_geometry::Point2D(1583.734508623855163,
                                         1319.8582573575095012),
                bezier_geometry::Point2D(1656.3248591313565612,
                                         1060.5695360193108172),
                bezier_geometry::Point2D(1530.070477541479022,
                                         822.74642711406249873)}),
           bezier_geometry::Point2D(1729.6165750987524916,
                                    1147.2375127268064716),
           false, 0.0073390247648537441233 /*0.025474014804683017821*/
       },
       {// A distance and 'angular slope' search result is very close to another
        // - requires sufficiently density in the starting parameters for the
        // Newton search.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3662.9028949253233804,
                                      1089.8259597966919046),
             bezier_geometry::Point2D(3733.7640444497787939,
                                      996.02639902707051078),
             bezier_geometry::Point2D(3666.452660398207172,
                                      899.64778267695362501),
             bezier_geometry::Point2D(3553.9907877000837289,
                                      933.88208275351701104),
             bezier_geometry::Point2D(3551.7969119857507394,
                                      1051.4186601320129739)},
            {bezier_geometry::Point2D(3732.4081546912270824,
                                      1068.6679987683130548),
             bezier_geometry::Point2D(3735.119934208329596,
                                      923.38479928582864886),
             bezier_geometry::Point2D(3597.7853865880861122,
                                      875.91076606807928329),
             bezier_geometry::Point2D(3510.1961888120827098,
                                      991.8533994389538293),
             bezier_geometry::Point2D(3593.3976351594196785,
                                      1110.9839208250709817)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3735.0937484284950187,
                                      1412.0317893743306286),
             bezier_geometry::Point2D(3871.8154490600918507,
                                      1276.4375505418620378),
             bezier_geometry::Point2D(3785.1069936413991854,
                                      1104.5065620986586055),
             bezier_geometry::Point2D(3594.7965204490446922,
                                      1133.8416063538616072),
             bezier_geometry::Point2D(3563.8866350197872634,
                                      1323.9026492082630284)},
            {bezier_geometry::Point2D(3852.7120892764451128,
                                      1393.9017349631324123),
             bezier_geometry::Point2D(3890.9188088437376791,
                                      1158.9733661205918906),
             bezier_geometry::Point2D(3679.2951784390597822,
                                      1050.0397580767260024),
             bezier_geometry::Point2D(3510.2978624590305117,
                                      1217.6434546309981215),
             bezier_geometry::Point2D(3617.47540758054447,
                                      1430.1618437855274806)}),
        bezier_geometry::Point2D(3603.6084465274525428, 896.45233480710294316),
        false, 359.68017004562415195},
       {// The blocked edge is touching the blocking edge at a point that just
        // BARELY has a sufficiently different slope to block.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(4353.2872582989602961,
                                      1620.7870240017807646),
             bezier_geometry::Point2D(4484.9864825168133393,
                                      1771.3038481126275201),
             bezier_geometry::Point2D(3882.9191860734263173,
                                      2298.1007449840417394),
             bezier_geometry::Point2D(3751.2199618555732741,
                                      2147.5839208731949839)},
            {bezier_geometry::Point2D(4419.1368704078868177,
                                      1696.0454360572041423),
             bezier_geometry::Point2D(4183.9528342951198283,
                                      2034.7022965483347434),
             bezier_geometry::Point2D(3817.0695739644997957,
                                      2222.8423329286188164),
             bezier_geometry::Point2D(4052.2536100772663303,
                                      1884.1854724374882153)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2312.8813898236912792,
                                      1236.3522534593209912),
             bezier_geometry::Point2D(3034.2069634800527638,
                                      623.42804406737150202),
             bezier_geometry::Point2D(3252.874346996894019,
                                      560.28858742882653132),
             bezier_geometry::Point2D(3445.0593579514579687,
                                      682.2186377163020552),
             bezier_geometry::Point2D(3481.090248732532018,
                                      906.9491218706205018),
             bezier_geometry::Point2D(3336.6561297844527871,
                                      1082.8490959536318314),
             bezier_geometry::Point2D(3136.4385611387624522,
                                      1182.0671164461236913),
             bezier_geometry::Point2D(2782.8527867250750205,
                                      1614.300080867413044),
             bezier_geometry::Point2D(2874.2941294823776843,
                                      2165.196365330181834),
             bezier_geometry::Point2D(3348.5609776114370106,
                                      2460.0169754745020327),
             bezier_geometry::Point2D(3883.0403697642677798,
                                      2298.2145812892395043),
             bezier_geometry::Point2D(5018.8502184123226471,
                                      1303.9887072093979441),
             bezier_geometry::Point2D(5018.8502184123226471, 2521),
             bezier_geometry::Point2D(2312.8813898236912792, 2521)},
            {bezier_geometry::Point2D(2673.5441766518724762,
                                      929.89014876334613291),
             bezier_geometry::Point2D(3129.3199907554217134,
                                      542.60867598351796914),
             bezier_geometry::Point2D(3376.428703238365415,
                                      577.96849887413554825),
             bezier_geometry::Point2D(3513.6900126645487035,
                                      786.46877655846788002),
             bezier_geometry::Point2D(3448.4904848005153326,
                                      1027.4294671827713046),
             bezier_geometry::Point2D(3236.5473454616076197,
                                      1132.4581061998776477),
             bezier_geometry::Point2D(2861.8175448629181119,
                                      1318.1558413508964804),
             bezier_geometry::Point2D(2703.8880285872310196,
                                      1910.4443203839296075),
             bezier_geometry::Point2D(3044.700230377524349,
                                      2419.948410276433151),
             bezier_geometry::Point2D(3652.4217248453505817,
                                      2500.085540672570005),
             bezier_geometry::Point2D(4450.9452940882947587,
                                      1801.1016442493187242),
             bezier_geometry::Point2D(5018.8502184123226471,
                                      1912.494353604698972),
             bezier_geometry::Point2D(3665.8658041180069631, 2521),
             bezier_geometry::Point2D(2312.8813898236912792,
                                      1878.6761267296606093)}),
        bezier_geometry::Point2D(4438.1406269731278371, 1772.5979838274006397),
        true, 0.012411312879755050792},
       {// Initial intersection at the rotation fulcrum.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(14.63465527725928041,
                                      17.018173865786170609),
             bezier_geometry::Point2D(12.846158997225620624,
                                      21.687358061800050564)},
            {bezier_geometry::Point2D(13.740407137242450517,
                                      19.352765963793110586),
             bezier_geometry::Point2D(14, 20)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(14.171572875253809798,
                                      17.328427124746190202),
             bezier_geometry::Point2D(14.647101133401386051,
                                      16.982935621933663697)},
            {bezier_geometry::Point2D(14.534844139256488234,
                                      17.328427124746190202),
             bezier_geometry::Point2D(14.409337004327598, 17.155681373339927)}),
        bezier_geometry::Point2D(14.634648240660358169, 17.018192236065629004),
        false, 0.00082069333154307299531},
       {// Curves intersect at the fulcrum, but just barely within tolerances;
        // testing the rotated intersection does not yield a fulcrum point;
        // tests the recursive rotateAgainst for fulcrum intersections.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2337.9759070279674233,
                                      1150.0994419233193184),
             bezier_geometry::Point2D(3137.9657844392168045,
                                      1146.0750115866851502)},
            {bezier_geometry::Point2D(2737.9708457335923413,
                                      1148.087226755002348),
             bezier_geometry::Point2D(2737.9708457335923413, 1160)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2116.7953642762963682,
                                      80.013134053301641302),
             bezier_geometry::Point2D(1925.9992650426424916,
                                      139.98686594670380146)},
            {bezier_geometry::Point2D(2675.1109922975483641,
                                      2189.6774816468314384),
             bezier_geometry::Point2D(2021.39731465946943,
                                      110.000000000002721)}),
        bezier_geometry::Point2D(2346.8367292004754745, 1150.0548666601362129),
        false, 0.0047987241993244014737},
       {// Blocking point is near the fulcrum, tests the different cases for
        // matching rotated slopes in rotateAgainst.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(4174.749322553841921,
                                      1157.7453554265846378),
             bezier_geometry::Point2D(4176.8046761232753852,
                                      1357.7347939519843294),
             bezier_geometry::Point2D(3376.8469220216766189,
                                      1365.9562082297179586),
             bezier_geometry::Point2D(3374.7915684522431548,
                                      1165.966769704318267)},
            {bezier_geometry::Point2D(4175.7769993385581984,
                                      1257.7400746892844836),
             bezier_geometry::Point2D(3776.825799072476002,
                                      1361.8455010908512577),
             bezier_geometry::Point2D(3375.8192452369598868,
                                      1265.9614889670181128),
             bezier_geometry::Point2D(3774.7704455030425379,
                                      1161.8560625654515661)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2978.3030493388359901,
                                      106.99494437906218991),
             bezier_geometry::Point2D(3121.7076855506679749,
                                      63.005055620938357208)},
            {bezier_geometry::Point2D(3050.0053674447522098,
                                      85.000000000000270006),
             bezier_geometry::Point2D(3713.0796239922051427,
                                      2246.5858831663481396)}),
        bezier_geometry::Point2D(3380.8068693248264935, 1165.9049485891091535),
        true, 0.73916488581038830574},
       {// Rotation is tiny and results in an infinite intersection.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(4085.4140704683832155,
                                      1722.1550267746993086),
             bezier_geometry::Point2D(4185.4140704683659351,
                                      1722.1549677379559853),
             bezier_geometry::Point2D(4185.4144329013761308,
                                      2336.0658818618553596),
             bezier_geometry::Point2D(4085.4144329013938659,
                                      2336.0659408985989103),
             bezier_geometry::Point2D(4085.4142694118208965,
                                      2059.1374321100652196),
             bezier_geometry::Point2D(4135.4142694118118015,
                                      2059.1374025916934443),
             bezier_geometry::Point2D(4135.4141218199538343,
                                      1809.1374025917371),
             bezier_geometry::Point2D(4085.4141218199624745,
                                      1809.137432110108648)},
            {bezier_geometry::Point2D(4135.4140704683741205,
                                      1722.1549972563275333),
             bezier_geometry::Point2D(4185.4142516848714877,
                                      2029.1104247999057861),
             bezier_geometry::Point2D(4135.4144329013852257,
                                      2336.0659113802271349),
             bezier_geometry::Point2D(4085.4143511566076086,
                                      2197.6016865043320649),
             bezier_geometry::Point2D(4110.414269411816349,
                                      2059.1374173508793319),
             bezier_geometry::Point2D(4135.4141956158828179,
                                      1934.1374025917152721),
             bezier_geometry::Point2D(4110.4141218199583818,
                                      1809.1374173509229877),
             bezier_geometry::Point2D(4085.4140961441730724,
                                      1765.646229442404092)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3985.4144329013761308,
                                      1557.0890858759935327),
             bezier_geometry::Point2D(4285.4144329013761308,
                                      1557.0890858759935327),
             bezier_geometry::Point2D(4285.4144329013761308,
                                      1757.0890858759935327),
             bezier_geometry::Point2D(4185.4144329013761308,
                                      1757.0890858759935327),
             bezier_geometry::Point2D(4185.4144329013761308,
                                      1657.0890858759935327),
             bezier_geometry::Point2D(3985.4144329013761308,
                                      1657.0890858759935327)},
            {bezier_geometry::Point2D(4135.4144329013761308,
                                      1557.0890858759935327),
             bezier_geometry::Point2D(4285.4144329013761308,
                                      1657.0890858759935327),
             bezier_geometry::Point2D(4235.4144329013761308,
                                      1757.0890858759935327),
             bezier_geometry::Point2D(4185.4144329013761308,
                                      1707.0890858759935327),
             bezier_geometry::Point2D(4085.4144329013761308,
                                      1657.0890858759935327),
             bezier_geometry::Point2D(3985.4144329013761308,
                                      1607.0890858759935327)}),
        bezier_geometry::Point2D(4185.4144329013761308, 2336.0658818618639998),
        false, 3.3825562282153558971e-5},
       {// One edge test combo involves a crisscross intersection that doesn't
        // block anything, and one curve's overlapping perp mag intervals
        // doesn't quite contain the intersection point.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(2740.8503883899415996,
                                      1405.4600150686433153),
             bezier_geometry::Point2D(2888.5373133981861429,
                                      1379.2193561285710075)},
            {bezier_geometry::Point2D(2814.6938508940638712,
                                      1392.3396855986072751),
             bezier_geometry::Point2D(2981.5250179266586201,
                                      2331.2940811741909783)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(3316.9329747503606995,
                                      1463.4148067535384143),
             bezier_geometry::Point2D(3169.0805605292330256,
                                      1598.0983751981862042),
             bezier_geometry::Point2D(2630.3462867506423208,
                                      1006.6887183136756221),
             bezier_geometry::Point2D(2778.1987009717699948,
                                      872.0051498690279459)},
            {bezier_geometry::Point2D(3243.0067676397970899,
                                      1530.7565909758623093),
             bezier_geometry::Point2D(2899.7134236399379006,
                                      1302.3935467559308563),
             bezier_geometry::Point2D(2704.2724938612063852,
                                      939.34693409135184083),
             bezier_geometry::Point2D(3047.5658378610651198,
                                      1167.7099783112830664)}),
        bezier_geometry::Point2D(2814.6938508940638712, 1392.3396855986070477),
        false, 161.26672249370540158},
       {// Infinite initial intersection, the output angle is not overly
        // important, the output blocking point should not be the fulcrum.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(810, 1156.1483426796344247),
             bezier_geometry::Point2D(910, 1156.1483426796344247),
             bezier_geometry::Point2D(910, 1435.6410680555397903),
             bezier_geometry::Point2D(810, 1435.6410680555397903)},
            {bezier_geometry::Point2D(860, 1156.1483426796344247),
             bezier_geometry::Point2D(910, 1295.8947053675869938),
             bezier_geometry::Point2D(860, 1435.6410680555397903),
             bezier_geometry::Point2D(810, 1295.8947053675869938)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(810, 1065.9662921348312921),
             bezier_geometry::Point2D(810, 1265.9662921348312921),
             bezier_geometry::Point2D(10, 1265.9662921348312921),
             bezier_geometry::Point2D(10, 1065.9662921348312921)},
            {bezier_geometry::Point2D(810, 1165.9662921348312921),
             bezier_geometry::Point2D(410, 1265.9662921348312921),
             bezier_geometry::Point2D(10, 1165.9662921348312921),
             bezier_geometry::Point2D(410, 1065.9662921348312921)}),
        bezier_geometry::Point2D(810, 1156.1483426796344247), false, 0},
       {// Two straight lines - the blocking point is an endpoint of both curves
        // at PRECISELY parameter 0.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(190.78961993021044918,
                                      2394.8219020215465207),
             bezier_geometry::Point2D(10.000000000000113687,
                                      2309.2934662502188985),
             bezier_geometry::Point2D(352.11374308531009092,
                                      1586.1349865293775565),
             bezier_geometry::Point2D(532.90336301552042642,
                                      1671.6634223007049513)},
            {bezier_geometry::Point2D(100.39480996510526722,
                                      2352.0576841358824822),
             bezier_geometry::Point2D(181.0568715426551023,
                                      1947.7142263897981138),
             bezier_geometry::Point2D(442.50855305041523025,
                                      1628.8992044150413676),
             bezier_geometry::Point2D(361.84649147286540938,
                                      2033.242662161125736)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(148.85051290648203803,
                                      1240.5106742536338515),
             bezier_geometry::Point2D(-638.49305263684345846,
                                      868.02753714464313362),
             bezier_geometry::Point2D(-629.72207547411085216,
                                      1688.3457556059865965),
             bezier_geometry::Point2D(-116.22705460123279408,
                                      2328.1283539304049555),
             bezier_geometry::Point2D(256.25608250775769648,
                                      1540.7847883870795158),
             bezier_geometry::Point2D(527.43990760845917976,
                                      1669.0787204483899586),
             bezier_geometry::Point2D(552.42923335484852032,
                                      1265.5000000000231921)},
            {bezier_geometry::Point2D(-244.82126986518085232,
                                      1054.2691056991384357),
             bezier_geometry::Point2D(-775.89035178871029075,
                                      1279.7026112354026282),
             bezier_geometry::Point2D(-483.55379915951141356,
                                      2096.9888999765717017),
             bezier_geometry::Point2D(70.014513953262564883,
                                      1934.456571158742463),
             bezier_geometry::Point2D(391.84799505810872233,
                                      1604.9317544177342825),
             bezier_geometry::Point2D(539.93457048165396372,
                                      1467.2893602242061206),
             bezier_geometry::Point2D(350.63987313066519391,
                                      1253.0053371268284081)}),
        bezier_geometry::Point2D(530.17163531198980309, 1670.3710713745476824),
        true, 179.99999999999221245},
       {// The curves touch near the fulcrum right at the end of the moving
        // curve; hits a special case when getting crit intervals on the moving
        // edge.
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(4022.7156902370379612,
                                      1187.3217282578241338),
             bezier_geometry::Point2D(3245.5773813345613235,
                                      2262.8091452584467334)},
            {bezier_geometry::Point2D(3634.1465357857996423,
                                      1725.0654367581350925),
             bezier_geometry::Point2D(3715.2002407850982308,
                                      1783.6341733493122774)}),
        bezier_geometry::Shape(
            {bezier_geometry::Point2D(4072.7156961732471245,
                                      1954.7007687965879086),
             bezier_geometry::Point2D(4072.7156961732471245,
                                      10.000000000000227374),
             bezier_geometry::Point2D(3972.7156961732471245,
                                      10.000000000000227374),
             bezier_geometry::Point2D(3972.7156961732471245,
                                      1187.3213951625286882),
             bezier_geometry::Point2D(4022.7156961732471245,
                                      1187.3213951625286882),
             bezier_geometry::Point2D(4022.7156961732471245,
                                      1954.7007687965879086)},
            {bezier_geometry::Point2D(4072.7156961732471245,
                                      982.35038439829406798),
             bezier_geometry::Point2D(4022.7156961732471245,
                                      10.000000000000227374),
             bezier_geometry::Point2D(3972.7156961732471245,
                                      598.66069758126445777),
             bezier_geometry::Point2D(3997.7156961732471245,
                                      1187.3213951625286882),
             bezier_geometry::Point2D(4022.7156961732471245,
                                      1571.0110819795581847),
             bezier_geometry::Point2D(4047.7156961732471245,
                                      1954.7007687965879086)}),
        bezier_geometry::Point2D(4022.7164971368483748, 1187.3213951625284608),
        true, 0}});
  for (const RotateTestEntry &currentEntry : testEntries) {
    bezier_geometry::Shape::RotateAgainstResult result;
    debug() << "*** BEFORE Shape::rotateAgainst" << std::endl;
    currentEntry.moving.rotateAgainst(currentEntry.stationary,
                                      currentEntry.fulcrum,
                                      currentEntry.clockwise, result);
    debug()
        << "*** AFTER Shape::rotateAgainst -"
        << "angle:" << bezier_geometry::toString(result.movingEdgeResult.angle)
        << "expected:" << bezier_geometry::toString(currentEntry.expectedAngle)
        << "moving edge param:"
        << bezier_geometry::toString(result.movingEdgeResult.param)
        << "moving edge:"
        << (result.movingEdgeResult.angle >= 0 ? result.movingEdge->toString()
                                               : std::string())
        << "stationary edge param:"
        << bezier_geometry::toString(result.movingEdgeResult.inputParam)
        << "stationary edge:"
        << (result.movingEdgeResult.angle >= 0
                ? result.stationaryEdge->toString()
                : std::string())
        << "moving blocking point:"
        << (result.movingEdgeResult.angle >= 0
                ? result.movingEdge->valueAt(result.movingEdgeResult.param)
                          .rotate(currentEntry.fulcrum,
                                  result.movingEdgeResult.angle *
                                      (currentEntry.clockwise ? (-1.0) : 1.0))
                          .toString() +
                      " " +
                      bezier_geometry::toString(result.movingEdgeResult.param)
                : std::string())
        << "stationary blocking point:"
        << (result.movingEdgeResult.angle >= 0
                ? result.stationaryEdge
                          ->valueAt(result.movingEdgeResult.inputParam)
                          .toString() +
                      " " +
                      bezier_geometry::toString(
                          result.movingEdgeResult.inputParam)
                : std::string())
        << "blockedCWVerticalAngleStart:"
        << bezier_geometry::toString(
               result.movingEdgeResult.blockedCWVerticalAngleStart)
        << "blockedCWVerticalAngleEnd:"
        << bezier_geometry::toString(
               result.movingEdgeResult.blockedCWVerticalAngleEnd)
        << "rotated interesction:"
        << (result.movingEdgeResult.angle >= 0
                ? result.movingEdge
                      ->rotate(currentEntry.fulcrum,
                               result.movingEdgeResult.angle *
                                   (currentEntry.clockwise ? (-1.0) : 1.0))
                      .pointsOfIntersection(*result.stationaryEdge)
                : std::vector<std::pair<bezier_geometry::RealNum,
                                        bezier_geometry::RealNum>>())
        << std::endl;
    CHECK(bezier_geometry::sufficientlyClose(result.movingEdgeResult.angle,
                                             currentEntry.expectedAngle),
          true);
    if (result.movingEdgeResult.angle >=
        0) { // TODO - investigate why I need such a large distance tolerance
             // here.
      //      CHECK(result.movingEdge->valueAt(result.movingEdgeResult.param).rotate(currentEntry.fulcrum,
      //        result.movingEdgeResult.angle*(currentEntry.clockwise?(-1.0):1.0)),
      //        result.stationaryEdge->valueAt(result.movingEdgeResult.inputParam));
      // Appears to be because of the degree of lienience allowed for endpoint
      // blocks.

      CHECK(result.movingEdge->valueAt(result.movingEdgeResult.param)
                    .rotate(currentEntry.fulcrum,
                            result.movingEdgeResult.angle *
                                (currentEntry.clockwise ? (-1.0) : 1.0))
                    .distanceFrom(result.stationaryEdge->valueAt(
                        result.movingEdgeResult.inputParam)) < 1,
            true);
    }
    CHECK(result.movingEdgeResult.blockedCWVerticalAngleStart < 0,
          result.movingEdgeResult.blockedCWVerticalAngleEnd < 0);
  }
  TEST_END
}

void shiftAgainstAfterShiftingTest() {
  TEST_START
  struct TestEntry {
    bezier_geometry::Shape moving;
    bezier_geometry::Shape stationaryBeforeShift;
    bezier_geometry::RealNum movingSlope;
    bool movingRight;
    bool movingUp;
    bezier_geometry::RealNum stationaryShiftDistance;
    bezier_geometry::RealNum stationaryShiftSlope;
    bool stationaryShiftRight;
    bool stationaryShiftUp;
    bezier_geometry::RealNum expectedDistance;
  };
  for (const TestEntry &currentEntry : std::initializer_list<TestEntry>{
           {// Two squares, stationary is not in path initially or after, shift
            // does not cross moving path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 100, 0, false, false, -1},
           {// Two squares, stationary is not in path initially, shift barely
            // touches moving path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 1, 1, false, false, -1},
           {// Two squares, stationary is not in path initially, shift places
            // stationary in moving path, the shape will block.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 2, 1, false, false, 6.5857864376269041884},
           {// Two squares, stationary is not in path initially, shift places
            // stationary in moving path, the shape will block.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 3, 1, false, false, 5.8786796564403580589},
           {// Two squares, stationary is not in path initially, shift places
            // stationary fully across moving path, crit shift path will block.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 10, 1, false, false, 3},
           {// Two squares, stationary is not in path initially, shift places
            // stationary fully across moving path, crit shift path will block.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 100, 1, false, false, 3}}) {
    debug() << "*** BEFORE shiftAgainstAfterShifting ***" << std::endl;
    const bezier_geometry::RealNum distance =
        currentEntry.moving.shiftAgainstAfterShifting(
            currentEntry.stationaryBeforeShift,
            currentEntry.stationaryShiftDistance,
            currentEntry.stationaryShiftSlope,
            currentEntry.stationaryShiftRight, currentEntry.stationaryShiftUp,
            currentEntry.movingSlope, currentEntry.movingRight,
            currentEntry.movingUp);
    debug() << "^ After shiftAgainstAfterShifting -"
            << "distance:" << bezier_geometry::toString(distance) << "expected:"
            << bezier_geometry::toString(currentEntry.expectedDistance)
            << std::endl;
    CHECK(bezier_geometry::sufficientlyClose(distance,
                                             currentEntry.expectedDistance),
          true);
  }
  TEST_END
}

void shiftAgainstAfterRotatingTest() {
  TEST_START
  struct TestEntry {
    bezier_geometry::Shape moving;
    bezier_geometry::Shape stationaryBeforeShift;
    bezier_geometry::RealNum movingSlope;
    bool movingRight;
    bool movingUp;
    bezier_geometry::RealNum stationaryRotateAngle;
    bezier_geometry::Point2D stationaryRotateFulcrum;
    bool stationaryRotateClockwise;
    bezier_geometry::RealNum expectedDistance;
  };
  for (const TestEntry &currentEntry : std::initializer_list<TestEntry>{
           {// Two squares, stationary is not in path initially, rotate does not
            // place stationary in moving path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 0, bezier_geometry::Point2D(11, 0), false, -1},
           {// Two squares, stationary is not in path initially, rotate does not
            // place stationary in moving path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 10, bezier_geometry::Point2D(11, 0), false, -1},
           {// Two squares, stationary is not in path initially, rotate places
            // stationary in moving path, blocked by post-move stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 44, bezier_geometry::Point2D(11, 0), false,
            5.1029336755787788604},
           {// Two squares, stationary is not in path initially, rotate places
            // stationary in moving path, blocked by post-move stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 45, bezier_geometry::Point2D(11, 0), false, 5},
           {// Two squares, stationary is not in path initially, rotate places
            // stationary in moving path, blocked by post-move stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 90, bezier_geometry::Point2D(11, 0), false, 2},
           {// Two squares, stationary is not in path initially, rotate places
            // stationary in moving path, blocked by crit arc path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 120, bezier_geometry::Point2D(11, 0), false,
            1.7550020016016025792},
           {// Two squares, stationary is not in path initially, rotate places
            // stationary in moving path, blocked by crit arc path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 4),
                                    bezier_geometry::Point2D(11, 6),
                                    bezier_geometry::Point2D(13, 6),
                                    bezier_geometry::Point2D(13, 4)},
                                   {bezier_geometry::Point2D(11, 5),
                                    bezier_geometry::Point2D(12, 6),
                                    bezier_geometry::Point2D(13, 5),
                                    bezier_geometry::Point2D(12, 4)}),
            0, true, true, 500.25, bezier_geometry::Point2D(11, 0), false,
            1.7550020016016025792},
           {// Internally uses a circle arc with a very small radius whose slope
            // with the matching curve point matches the slope with its fulcrum.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(3359.0187956359486634,
                                          1261.5518463772832547),
                 bezier_geometry::Point2D(3159.0187956379954812,
                                          1261.5527512017602021),
                 bezier_geometry::Point2D(3159.0151763400876916,
                                          461.55275120994724602),
                 bezier_geometry::Point2D(3359.0151763380408738,
                                          461.55184638547029863)},
                {bezier_geometry::Point2D(3259.0187956369718449,
                                          1261.5522987895217284),
                 bezier_geometry::Point2D(3159.0169859890415864,
                                          861.55275120585361037),
                 bezier_geometry::Point2D(3259.0151763390645101,
                                          461.55229879770877233),
                 bezier_geometry::Point2D(3359.0169859869947686,
                                          861.55184638137677666)}),
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(3391.1113461501654456,
                                          254.503160351090429),
                 bezier_geometry::Point2D(3491.1113461487707355,
                                          254.50263220244835338),
                 bezier_geometry::Point2D(3491.1158892521998496,
                                          1114.6967266540598303),
                 bezier_geometry::Point2D(3391.1158892535945597,
                                          1114.6972548027015364)},
                {bezier_geometry::Point2D(3441.1113461494678631,
                                          254.50289627676937698),
                 bezier_geometry::Point2D(3491.1136177004855199,
                                          684.59967942825403497),
                 bezier_geometry::Point2D(3441.115889252897432,
                                          1114.6969907283805696),
                 bezier_geometry::Point2D(3391.11361770188023,
                                          684.60020757689608217)}),
            -5.2814864236436863247e-6, true, false, 2.8133994511766005076,
            bezier_geometry::Point2D(3391.1153945846235729,
                                     1114.697254805126704),
            true, 0},
           {// The small shift slope should trigger a recursive call with a
            // rotated curve, otherwise the calculated circle point is too
            // inaccurate (division by a very small amount).
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(3488.67643015601152,
                                          1690.4593033376868334),
                 bezier_geometry::Point2D(3688.6488864746206673,
                                          1687.1401597882340866),
                 bezier_geometry::Point2D(3701.9254606724321093,
                                          2487.0299850626715852),
                 bezier_geometry::Point2D(3501.9530043538225073,
                                          2490.349128612124332)},
                {bezier_geometry::Point2D(3588.6626583153160936,
                                          1688.79973156296046),
                 bezier_geometry::Point2D(3695.2871735735266157,
                                          2087.0850724254528359),
                 bezier_geometry::Point2D(3601.9392325131275356,
                                          2488.6895568373979586),
                 bezier_geometry::Point2D(3495.3147172549170136,
                                          2090.4042159749055827)}),
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(3767.6207886798365507,
                                          1713.5815622549928321),
                 bezier_geometry::Point2D(3867.607015849031086,
                                          1711.9219308289682431),
                 bezier_geometry::Point2D(3881.1825585060000776,
                                          2529.7946649553396128),
                 bezier_geometry::Point2D(3781.1963313368059971,
                                          2531.4542963813646566)},
                {bezier_geometry::Point2D(3817.6139022644338183,
                                          1712.7517465419805376),
                 bezier_geometry::Point2D(3874.3947871775158092,
                                          2120.8582978921540416),
                 bezier_geometry::Point2D(3831.1894449214032647,
                                          2530.6244806683525894),
                 bezier_geometry::Point2D(3774.4085600083212739,
                                          2122.5179293181790854)}),
            -0.016598003597878132481, true, false, 5.8058563728865983933,
            bezier_geometry::Point2D(3780.436858986918196,
                                     2485.7268525909735217),
            true, 0.4027910184638877622},
           {// Tests the condition where the curve point and the arc fulcrum
            // slope matches the input slope on both the slope value and the
            // perpendicular magnitudes.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(-108836673.67324253917,
                                          232249149.06061032414),
                 bezier_geometry::Point2D(-108836764.22322912514,
                                          232249106.62595552206),
                 bezier_geometry::Point2D(-108836192.91461963952,
                                          232247887.52832961082),
                 bezier_geometry::Point2D(-108836102.36463305354,
                                          232247929.96298441291)},
                {bezier_geometry::Point2D(-108836718.94823583961,
                                          232249127.8432829082),
                 bezier_geometry::Point2D(-108836478.56892438233,
                                          232248497.07714256644),
                 bezier_geometry::Point2D(-108836147.63962635398,
                                          232247908.74565702677),
                 bezier_geometry::Point2D(-108836388.01893779635,
                                          232248539.51179736853)}),
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(2893.6470387198678509,
                                          1773.4490088033785469),
                 bezier_geometry::Point2D(2712.5471215150146236,
                                          1688.5795797467665125),
                 bezier_geometry::Point2D(3052.0248377414627612,
                                          964.17991092735348957),
                 bezier_geometry::Point2D(3233.1247549463159885,
                                          1049.0493399839656377)},
                {bezier_geometry::Point2D(2803.0970801174412372,
                                          1731.0142942750726434),
                 bezier_geometry::Point2D(2882.2859796282386924,
                                          1326.3797453370600579),
                 bezier_geometry::Point2D(3142.5747963438893748,
                                          1006.6146254556595068),
                 bezier_geometry::Point2D(3063.3858968330919197,
                                          1411.2491743936720923)}),
            -2.133854926426170362, true, false, 8.8549695355584265855,
            bezier_geometry::Point2D(3114.1225490196084138,
                                     1011.1593137254901649),
            false, 256484318.24374169111}}) {
    debug() << "*** BEFORE shiftAgainstAfterRotating ***" << std::endl;
    const bezier_geometry::RealNum distance =
        currentEntry.moving.shiftAgainstAfterRotating(
            currentEntry.stationaryBeforeShift,
            currentEntry.stationaryRotateAngle,
            currentEntry.stationaryRotateFulcrum,
            currentEntry.stationaryRotateClockwise, currentEntry.movingSlope,
            currentEntry.movingRight, currentEntry.movingUp);
    debug() << "^ After shiftAgainstAfterRotating -"
            << "distance:" << bezier_geometry::toString(distance) << "expected:"
            << bezier_geometry::toString(currentEntry.expectedDistance)
            << "stationaryRotateAngle:"
            << bezier_geometry::toString(currentEntry.stationaryRotateAngle)
            << std::endl;
    CHECK(bezier_geometry::sufficientlyClose(distance,
                                             currentEntry.expectedDistance),
          true);
  }
  TEST_END
}

void rotateAgainstAfterShiftingTest() {
  TEST_START
  struct TestEntry {
    bezier_geometry::Shape moving;
    bezier_geometry::Shape stationaryBeforeShift;
    bezier_geometry::Point2D movingFulcrum;
    bool movingClockwise;
    bezier_geometry::RealNum stationaryShiftDistance;
    bezier_geometry::RealNum stationaryShiftSlope;
    bool stationaryShiftRight;
    bool stationaryShiftUp;
    bezier_geometry::RealNum expectedAngle;
  };
  for (const TestEntry &currentEntry : std::initializer_list<TestEntry>{
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary box has no shift distance, blocked by
            // stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 0, 0, true, true, 180},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary box shifts along slope with fulcrum, blocked
            // by stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 1, 0, true, true, 180},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary box shifts along slope with fulcrum, blocked
            // by stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 10, 0, true, true, 180},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary box shifts along slope with fulcrum out of
            // moving's rotation path, blocked by crit shift path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 1000, 0, true, true, 180},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary shifts along rotation circle tangent, blocked
            // by post-shift stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 1,
            std::numeric_limits<bezier_geometry::RealNum>::infinity(), true,
            true, 165.96375653207351775},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary shifts along rotation circle tangent, blocked
            // by post-shift stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 2,
            std::numeric_limits<bezier_geometry::RealNum>::infinity(), true,
            true, 153.43494882292199577},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary shifts along rotation circle tangent out of
            // rotation path, blocked by crit shift path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 100,
            std::numeric_limits<bezier_geometry::RealNum>::infinity(), true,
            true, 131.81031489577861748},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary shifts along rotation circle tangent out of
            // rotation path, blocked by crit shift path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 1000,
            std::numeric_limits<bezier_geometry::RealNum>::infinity(), true,
            true, 131.81031489577861748}}) {
    debug() << "*** BEFORE rotateAgainstAfterShifting ***" << std::endl;
    const bezier_geometry::RealNum angle =
        currentEntry.moving.rotateAgainstAfterShifting(
            currentEntry.stationaryBeforeShift,
            currentEntry.stationaryShiftDistance,
            currentEntry.stationaryShiftSlope,
            currentEntry.stationaryShiftRight, currentEntry.stationaryShiftUp,
            currentEntry.movingFulcrum, currentEntry.movingClockwise);
    debug() << "^ After rotateAgainstAfterShifting -"
            << "angle:" << bezier_geometry::toString(angle) << "expected:"
            << bezier_geometry::toString(currentEntry.expectedAngle)
            << std::endl;
    CHECK(bezier_geometry::sufficientlyClose(angle, currentEntry.expectedAngle),
          true);
  }
  TEST_END
}

void rotateAgainstAfterRotatingTest() {
  TEST_START
  struct TestEntry {
    bezier_geometry::Shape moving;
    bezier_geometry::Shape stationaryBeforeRotate;
    bezier_geometry::Point2D movingFulcrum;
    bool movingClockwise;
    bezier_geometry::RealNum stationaryRotateAngle;
    bezier_geometry::Point2D stationaryRotateFulcrum;
    bool stationaryRotateClockwise;
    bezier_geometry::RealNum expectedAngle;
  };
  for (const TestEntry &currentEntry : std::initializer_list<TestEntry>{
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary box has no shift distance, blocked by
            // stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 0,
            bezier_geometry::Point2D(7, 3), true, 180},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary rotates on the same fulcrum as moving in the
            // opposite direction, blocked by post-move stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 1,
            bezier_geometry::Point2D(7, 3), false, 179},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary rotates against moving's rotation, blocked by
            // post-move stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 1,
            bezier_geometry::Point2D(17, 3), true, 178.50076101044126631},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary rotates against moving's rotation, blocked by
            // post-move stationary.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 2,
            bezier_geometry::Point2D(17, 3), true, 177.00607533145011985},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary rotates against moving's rotation, blocked by
            // crit arc path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 90,
            bezier_geometry::Point2D(17, 3), true, 143.13010235415603688},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary rotates against moving's rotation, blocked by
            // crit arc path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 100,
            bezier_geometry::Point2D(17, 3), true, 143.13010235415603688},
           {// Two boxes, on either side of a circle formed by the rotation
            // fulcrum, stationary rotates against moving's rotation, blocked by
            // crit arc path.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1, 1), bezier_geometry::Point2D(1, 3),
                 bezier_geometry::Point2D(3, 3),
                 bezier_geometry::Point2D(3, 1)},
                {bezier_geometry::Point2D(1, 2), bezier_geometry::Point2D(2, 3),
                 bezier_geometry::Point2D(3, 2),
                 bezier_geometry::Point2D(2, 1)}),
            bezier_geometry::Shape({bezier_geometry::Point2D(11, 1),
                                    bezier_geometry::Point2D(11, 3),
                                    bezier_geometry::Point2D(13, 3),
                                    bezier_geometry::Point2D(13, 1)},
                                   {bezier_geometry::Point2D(11, 2),
                                    bezier_geometry::Point2D(12, 3),
                                    bezier_geometry::Point2D(13, 2),
                                    bezier_geometry::Point2D(12, 1)}),
            bezier_geometry::Point2D(7, 3), true, 361,
            bezier_geometry::Point2D(17, 3), true, 143.13010235415603688},
           {// Will attempt to find the points on a very small circle that match
            // the fulcrum slopes of a point very far away.
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1446.7106646063093649,
                                          1622.5068888949726897),
                 bezier_geometry::Point2D(1645.2347293327261468,
                                          2081.405783777605393),
                 bezier_geometry::Point2D(1828.7942872857793191,
                                          2001.9961578870386347),
                 bezier_geometry::Point2D(1630.2702225593625371,
                                          1543.0972630044059315)},
                {bezier_geometry::Point2D(1545.9726969695177559,
                                          1851.9563363362890414),
                 bezier_geometry::Point2D(1737.0145083092525056,
                                          2041.7009708323221275),
                 bezier_geometry::Point2D(1729.5322549225707007,
                                          1772.5467104457222831),
                 bezier_geometry::Point2D(1538.490443582835951,
                                          1582.8020759496894243)}),
            bezier_geometry::Shape(
                {bezier_geometry::Point2D(1457.4306502171323245,
                                          1143.562350004721111),
                 bezier_geometry::Point2D(1655.9521337461428629,
                                          1602.4623615294983665),
                 bezier_geometry::Point2D(1839.5121383560538106,
                                          1523.0537681178941511),
                 bezier_geometry::Point2D(1640.9906548270432722,
                                          1064.1537565931168956)},
                {bezier_geometry::Point2D(1556.6913919816377074,
                                          1373.0123557671097387),
                 bezier_geometry::Point2D(1747.7321360510982231,
                                          1562.7580648236962588),
                 bezier_geometry::Point2D(1740.2513965915486551,
                                          1293.6037623555055234),
                 bezier_geometry::Point2D(1549.2106525220876847,
                                          1103.8580532989190033)}),
            bezier_geometry::Point2D(1464.430364591374655,
                                     1663.4669143323344542),
            false, 0.00032227493773251891188,
            bezier_geometry::Point2D(1655.9520174155643417,
                                     1602.4623767035925539),
            true, 0}}) {
    debug() << "*** BEFORE rotateAgainstAfterRotating ***" << std::endl;
    const bezier_geometry::RealNum angle =
        currentEntry.moving.rotateAgainstAfterRotating(
            currentEntry.stationaryBeforeRotate,
            currentEntry.stationaryRotateAngle,
            currentEntry.stationaryRotateFulcrum,
            currentEntry.stationaryRotateClockwise, currentEntry.movingFulcrum,
            currentEntry.movingClockwise);
    debug() << "^ After rotateAgainstAfterRotating -"
            << "angle:" << bezier_geometry::toString(angle) << "expected:"
            << bezier_geometry::toString(currentEntry.expectedAngle)
            << std::endl;
    CHECK(bezier_geometry::sufficientlyClose(angle, currentEntry.expectedAngle),
          true);
  }
  TEST_END
}

int main(int argc, char **argv) {
  std::cout << "%SUITE_STARTING% ShapeTest" << std::endl;
  std::cout << "%SUITE_STARTED%" << std::endl;
  boundsAndEdgesTest();
  shiftTest();
  rotateTest();
  shiftAgainstAfterShiftingTest();
  shiftAgainstAfterRotatingTest();
  rotateAgainstAfterShiftingTest();
  rotateAgainstAfterRotatingTest();
  std::cout << "%SUITE_FINISHED% time=0" << std::endl;

  return (EXIT_SUCCESS);
}
